<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Physics Practice Hub</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #eef2f3;
      margin-right: 250px; /* Reserve space for difficulty panel */
    }
    h1, h2, h3 { color: #333; }
    .section { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
    .topics-grid { display: flex; flex-wrap: wrap; gap: 20px; }
    .topic-column { flex: 1 1 300px; }
    label { display: block; margin: 5px 0; }
    button { margin-top: 20px; padding: 10px 15px; font-size: 1em; }
    #question-box {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      margin-top: 30px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #score-box { font-weight: bold; margin-top: 10px; }
    .question-img { max-width: 100%; height: auto; margin: 10px 0; }
    /* Difficulty panel */
    #difficulty-container {
      position: fixed;
      top: 100px;
      right: 20px;
      width: 200px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #difficulty-container h3 { margin-top: 0; }
  </style>
</head>
<body>
  <h1>Cambridge Physics 9702 Practice Hub</h1>

  <!-- Whole Course Section -->
  <div class="section">
    <h2>Whole Course</h2>
    <label>
      <input type="checkbox" id="whole-defs" onchange="toggleByGroup('defs', this.checked)">
      Definitions
    </label>
    <label>
      <input type="checkbox" id="whole-eqs" onchange="toggleByGroup('eqs', this.checked)">
      Equations
    </label>
    <button onclick="startPractice()">Start Practice</button>
  </div>

  <!-- By Topic Section -->
  <div class="section">
    <h2>By Topic</h2>
    <div class="topics-grid">
      <div class="topic-column" id="topic-columns-left"></div>
      <div class="topic-column" id="topic-columns-right"></div>
    </div>
  </div>

  <!-- Another Start Practice Button -->
  <div class="section">
    <button onclick="startPractice()">Start Practice</button>
  </div>

  <div id="score-box">Score: <span id="score">0</span></div>
  <div id="question-box"></div>
  
  <!-- Container for dynamic diagrams -->
  <div id="diagramContainer"></div>
  
  <!-- Container for answer inputs -->
  <div id="answerInputs"></div>
  
  <!-- Feedback area -->
  <div id="feedback" style="font-weight: bold; margin-top: 10px;"></div>
  
  <!-- Difficulty Panel -->
  <div id="difficulty-container">
    <h3>Select Difficulty</h3>
    <input type="radio" name="difficulty" id="difficulty-go-easy" value="easy" checked>
    <label for="difficulty-go-easy">Go Easy</label><br>
    <input type="radio" name="difficulty" id="difficulty-im-getting-there" value="mixed">
    <label for="difficulty-im-getting-there">I'm Getting There</label><br>
    <input type="radio" name="difficulty" id="difficulty-hard" value="hard">
    <label for="difficulty-hard">Hard</label><br>
  </div>
  
  <script>
    /* -----------------------------
       Global Variables and Setup
    ----------------------------- */
    let answeredCurrent = false;  // Prevent repeated scoring
    let currentQuestion = null;   // The current question object
    let currentAnswers = null;    // Expected answer(s) or keyword groups
    let score = 0;                // User score
    let mixedCount = 0;           // For "I'm Getting There" mode (2 easy : 1 hard)

    // Utility: Ordinal suffix for harmonic questions
    function ordinalSuffix(n) {
      let j = n % 10, k = n % 100;
      if (j === 1 && k !== 11) return n + "st";
      if (j === 2 && k !== 12) return n + "nd";
      if (j === 3 && k !== 13) return n + "rd";
      return n + "th";
    }

    // Utility: Return a random element from an array
    function getRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    // Inline SVG for slope questions with ground line and centered box on the slope
function createSlopeSVG(mass, angle, distance) {
  const slopeStart = { x: 50, y: 150 };
  const slopeEnd   = { x: 200, y: 50 };
  const boxWidth   = 20;
  const boxHeight  = 20;

  // Calculate slope angle in radians
  const dx = slopeEnd.x - slopeStart.x;
  const dy = slopeEnd.y - slopeStart.y;
  const slopeAngle = Math.atan2(dy, dx);             // angle in radians
  const slopeAngleDeg = slopeAngle * (180 / Math.PI);

  // Midpoint of the slope line (where we’ll place and rotate the box)
  const midX = (slopeStart.x + slopeEnd.x) / 2;
  const midY = (slopeStart.y + slopeEnd.y) / 2;

  // For a dimension line offset, we move some pixels perpendicular to the slope.
  // A perpendicular vector to (dx, dy) is ( dy, -dx ) or ( -dy, dx ).
  // We'll choose ( dy, -dx ) for the offset direction.
  const offsetDistance = 10; // shift for the dimension line
  const slopeLength = Math.sqrt(dx * dx + dy * dy);
  // Unit vector perpendicular to the slope:
  const perpUx =  (dy / slopeLength);
  const perpUy = -(dx / slopeLength);
  // Actual offset in x,y
  const offsetX = offsetDistance * perpUx;
  const offsetY = offsetDistance * perpUy;

  // We'll place the label near the middle of the dimension line
  const midDimX = (slopeStart.x + slopeEnd.x) / 2 + offsetX;
  const midDimY = (slopeStart.y + slopeEnd.y) / 2 + offsetY - 2; // shift label slightly

  // Build the entire SVG as a string
  return `
<svg width="300" height="200" class="question-img" style="border:1px solid #ccc">

  <!-- Ground line (dashed, gray) -->
  <line x1="30" y1="150" x2="270" y2="150"
        stroke="gray" stroke-dasharray="4" />

  <!-- Actual slope line (orange) -->
  <line x1="${slopeStart.x}" y1="${slopeStart.y}"
        x2="${slopeEnd.x}"   y2="${slopeEnd.y}"
        stroke="orange" stroke-width="2" />

  <!-- Dimension line parallel to slope, offset by 10 px (blue, dashed) -->
  <line x1="${slopeStart.x + offsetX}" y1="${slopeStart.y + offsetY}"
        x2="${slopeEnd.x   + offsetX}" y2="${slopeEnd.y   + offsetY}"
        stroke="blue" stroke-dasharray="2,2" />

  <!-- Distance label in the middle of the dimension line -->
  <text x="${midDimX}" y="${midDimY}" fill="blue" font-size="12" text-anchor="middle">
    Distance = ${distance} m
  </text>

  <!-- A group to position and rotate the block so it sits on the slope line -->
  <g transform="translate(${midX}, ${midY}) rotate(${slopeAngleDeg})">
    <!-- 
      By drawing the rectangle at (0, -boxHeight),
      we ensure the bottom edge is at y=0 (the slope line),
      rather than centering the block around y=0.
    -->
    <rect x="0" y="${-boxHeight}" width="${boxWidth}" height="${boxHeight}" fill="brown" />
  </g>

  <!-- Text labels for angle and mass -->
  <!-- Position near the slope endpoints for clarity -->
  <text x="${slopeEnd.x + 5}" y="${slopeEnd.y + 10}"
        fill="red" font-size="12" text-anchor="start">
    Mass = ${mass} kg
  </text>
  <text x="${slopeStart.x + 5}" y="${slopeStart.y - 10}"
        fill="green" font-size="12" text-anchor="start">
    Angle = ${angle}°
  </text>

</svg>
  `;
}


    /* -----------------------------
       Topics & Topic Checkboxes
    ----------------------------- */
    const topics = [
      "Physical quantities and units",
      "Kinematics",
      "Dynamics",
      "Forces, density and pressure",
      "Work, energy and power",
      "Deformation of solids",
      "Waves",
      "Superposition",
      "Electricity",
      "D.C. circuits",
      "Particle and nuclear physics"
    ];

    function generateTopicCheckboxes() {
      const left = document.getElementById("topic-columns-left");
      const right = document.getElementById("topic-columns-right");
      topics.forEach((name, i) => {
        const topicNum = i + 1;
        const block = 
          `<h3>${topicNum}. ${name}</h3>
          <label><input type="checkbox" id="topic${topicNum}-defs"> Definitions</label>
          <label><input type="checkbox" id="topic${topicNum}-eqs"> Equations</label>`;
        if (i % 2 === 0) left.innerHTML += block;
        else right.innerHTML += block;
      });
    }

    function toggleByGroup(typeSuffix, isChecked) {
      const boxes = document.querySelectorAll(`input[id$="-${typeSuffix}"]`);
      boxes.forEach(box => box.checked = isChecked);
    }

    /* -----------------------------
       Full Question Bank
    ----------------------------- */
    const questionBank = [
      // --- Topic 1: Physical quantities and units ---
      {
        topic: 1, difficulty: "easy", type: "equation",
        question: function() {
          const km = 3.2, m = km * 1000;
          return { 
            text: `Convert ${km} km to meters.`,
            answer: m.toFixed(0),
            modelAnswer: `We know that 1 km equals 1000 m. Multiplying ${km} km by 1000 gives ${m} m.`
          };
        }
      },
      {
        topic: 1, difficulty: "easy", type: "equation",
        question: function() {
          const grams = 5000, kg = grams / 1000;
          return { 
            text: `Express ${grams} g in kilograms.`,
            answer: kg.toFixed(1),
            modelAnswer: `Since 1 kg equals 1000 g, dividing ${grams} by 1000 gives ${kg} kg.`
          };
        }
      },
      {
        topic: 1, difficulty: "easy", type: "equation",
        question: function() {
          const km = 60, hr = 1, mps = (km * 1000) / (hr * 3600);
          return { 
            text: `A car travels ${km} km in ${hr} hour. What is its speed in m/s?`,
            answer: mps.toFixed(2),
            modelAnswer: `Convert 60 km to 60000 m and 1 hour to 3600 s. Then, speed = 60000/3600 ≈ ${mps.toFixed(2)} m/s.`
          };
        }
      },
      {
        topic: 1, difficulty: "easy", type: "equation",
        question: function() {
          const mass_g = 2000, volume_cm3 = 500;
          const density = (mass_g / 1000) / (volume_cm3 / 1e6);
          return { 
            text: `A substance has ${mass_g} g and occupies ${volume_cm3} cm³. Calculate its density in kg/m³.`,
            answer: density.toFixed(0),
            modelAnswer: `Convert ${mass_g} g to ${mass_g/1000} kg and ${volume_cm3} cm³ to ${volume_cm3/1e6} m³. Then density = mass/volume ≈ ${density.toFixed(0)} kg/m³.`
          };
        }
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define a scalar quantity.",
        modelAnswer: "A scalar quantity is one that is described only by its magnitude without any direction.",
        keywords: [["magnitude", "size", "value"], ["no direction", "without direction", "directionless"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define a vector quantity.",
        modelAnswer: "A vector quantity has both magnitude and direction.",
        keywords: [["magnitude", "size", "value"], ["direction", "oriented"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define SI base quantity.",
        modelAnswer: "An SI base quantity is defined independently and is used as a foundation to derive other quantities.",
        keywords: [["independent", "without reference"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define random error.",
        modelAnswer: "Random error is the unpredictable variation in measurements due to small, uncontrollable factors.",
        keywords: [["unpredictable", "random"], ["variation", "fluctuation"], ["measurement", "reading"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define systematic error.",
        modelAnswer: "Systematic error is a consistent, repeatable error that skews measurements in the same direction, often due to faulty equipment or method.",
        keywords: [["consistent", "repeated", "constant"], ["error", "bias"], ["same direction", "same each time"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define precision.",
        modelAnswer: "Precision refers to the closeness of repeated measurements to each other.",
        keywords: [["consistency", "repeatability", "precision"], ["close", "near", "similar", "repeated measurements"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define accuracy.",
        modelAnswer: "Accuracy indicates how close a measurement is to the true or accepted value.",
        keywords: [["accuracy", "accurate", "closeness"], ["true value", "actual value", "correct value"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define absolute uncertainty.",
        modelAnswer: "Absolute uncertainty is the margin by which a measured value may deviate from the true value.",
        keywords: [["uncertainty", "error"], ["margin", "amount"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define percentage uncertainty.",
        modelAnswer: "Percentage uncertainty is the absolute uncertainty expressed as a percentage of the measured value.",
        keywords: [["percentage", "percent"], ["uncertainty", "error"], ["absolute", "real error"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Explain how to combine uncertainties for multiplication and division.",
        modelAnswer: "When multiplying or dividing, the percentage uncertainties of the values are added together to find the total percentage uncertainty.",
        keywords: [["add", "sum"], ["percentage uncertainty"]]
      },
      {
        topic: 1, difficulty: "hard", type: "equation",
        question: function() {
          const length = 1.20, uncertainty = 0.02;
          const perc = (uncertainty / length) * 100;
          return { 
            text: `An object is measured as ${length} m with an uncertainty of ${uncertainty} m. Calculate the percentage uncertainty.`,
            answer: perc.toFixed(2) + " %",
            modelAnswer: `Percentage uncertainty = (uncertainty/measurement)×100 = (0.02/1.20)×100 ≈ ${perc.toFixed(2)} %.`
          };
        }
      },
      
      // --- Topic 2: Kinematics ---
      {
        topic: 2, difficulty: "easy", type: "equation",
        question: function() {
          const u = Math.floor(Math.random()*10+5),
                a = Math.floor(Math.random()*4+1),
                t = Math.floor(Math.random()*4+2),
                s = u*t + 0.5*a*t*t;
          return { 
            text: `A body starts at ${u} m/s and accelerates at ${a} m/s² for ${t} s. Find its displacement.`,
            answer: s.toFixed(1),
            modelAnswer: `Displacement is given by s = ut + 0.5at². Substituting, s = ${u}×${t} + 0.5×${a}×${t}² ≈ ${s.toFixed(1)} m.`
          };
        }
      },
      {
        topic: 2, difficulty: "easy", type: "equation",
        question: function() {
          const m = Math.floor(Math.random()*20+5),
                angle = Math.floor(Math.random()*30+10),
                d = Math.floor(Math.random()*10+2),
                g = 9.8,
                a = g * Math.sin(angle * Math.PI/180),
                v = Math.sqrt(2 * a * d);
          return { 
            text: `A ${m} kg block slides down a ${angle}° frictionless slope for ${d} m. Find its speed at the bottom.`,
            answer: v.toFixed(2),
            modelAnswer: `First, calculate acceleration along the slope: a = g×sin(${angle}°) ≈ ${a.toFixed(2)} m/s². Then, use v = √(2ad) to get v ≈ ${v.toFixed(2)} m/s.`,
            image: createSlopeSVG(20, 23, 5)
          };
        }
      },
      {
        topic: 2, difficulty: "hard", type: "numeric_multi",
        question: function() {
          const mass = 20, angle = 23, distance = 5, g = 9.8;
          const a = g * Math.sin(angle * Math.PI/180);
          const v = Math.sqrt(2 * a * distance);
          const ke = 0.5 * mass * v * v;
          return { 
            text: `A ${mass} kg block slides down a ${angle}° slope for ${distance} m. Calculate: (a) the acceleration, (b) the final speed, and (c) the kinetic energy.`,
            answer: [a.toFixed(2), v.toFixed(2), ke.toFixed(2)],
            modelAnswer: [
              `Step 1: Calculate acceleration along the slope using a = g×sin(${angle}°). With g = 9.8 m/s², a ≈ ${a.toFixed(2)} m/s².`,
              `Step 2: Determine final speed using v = √(2ad) = √(2×${a.toFixed(2)}×${distance}) ≈ ${v.toFixed(2)} m/s.`,
              `Step 3: Compute kinetic energy using KE = 0.5×mass×v² = 0.5×${mass}×(${v.toFixed(2)})² ≈ ${ke.toFixed(2)} J.`
            ],
            image: createSlopeSVG(mass, angle, distance)
          };
        }
      },
      {
        topic: 2, difficulty: "hard", type: "equation",
        question: function() {
          const u = Math.floor(Math.random()*10+10),
                angle = Math.floor(Math.random()*30+30),
                g = 9.8,
                R = (u*u*Math.sin(2*angle*Math.PI/180))/g;
          return { 
            text: `A projectile is launched at ${angle}° with a speed of ${u} m/s. Calculate its horizontal range.`,
            answer: R.toFixed(2),
            modelAnswer: `For projectile motion, horizontal range R = (u²×sin(2θ))/g. Substituting, R = (${u}²×sin(2×${angle}°))/9.8 ≈ ${R.toFixed(2)} m.`
          };
        }
      },
      {
        topic: 2, difficulty: "easy", type: "equation",
        question: function() {
          const h = Math.floor(Math.random()*20+10),
                g = 9.8,
                t = Math.sqrt((2*h)/g);
          return { 
            text: `An object is launched horizontally from a height of ${h} m. Find the time to hit the ground.`,
            answer: t.toFixed(2),
            modelAnswer: `Using t = √(2h/g), with h = ${h} m and g = 9.8 m/s², t ≈ ${t.toFixed(2)} s.`
          };
        }
      },
      {
        topic: 2, difficulty: "easy", type: "equation",
        question: function() {
          const t = Math.floor(Math.random()*4+2),
                g = 9.8,
                s = 0.5 * g * t * t;
          return { 
            text: `An object free-falls for ${t} s. Find the distance it falls.`,
            answer: s.toFixed(1),
            modelAnswer: `Using s = 0.5×g×t², with t = ${t} s and g = 9.8 m/s², the distance is ≈ ${s.toFixed(1)} m.`
          };
        }
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "Define displacement.",
        modelAnswer: "Displacement is the change in position of an object in a specific direction.",
        keywords: [["displacement", "distance"], ["direction", "oriented", "straight line"], ["between two points", "start to end"]]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "Define speed.",
        modelAnswer: "Speed is the distance traveled per unit time.",
        keywords: [["distance"], ["time", "per second"]]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "Define velocity.",
        modelAnswer: "Velocity is displacement per unit time that includes direction.",
        keywords: [["displacement"], ["time"], ["direction"]]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "Define acceleration.",
        modelAnswer: "Acceleration is the rate at which velocity changes over time.",
        keywords: [["change", "rate"], ["velocity"], ["time"]]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "State what the gradient of a displacement–time graph represents.",
        modelAnswer: "The gradient of a displacement–time graph represents the velocity.",
        keywords: ["velocity]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "State what the gradient of a velocity–time graph represents.",
        modelAnswer: "The gradient of a velocity–time graph represents the acceleration.",
        keywords: ["acceleration"]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "State what the area under a velocity–time graph represents.",
        modelAnswer: "The area under a velocity–time graph represents the displacement.",
        keywords: ["displacement"]
      },
      
      // --- Topic 3: Dynamics ---
      {
        topic: 3, difficulty: "easy", type: "equation",
        question: function() {
          const L = Math.floor(Math.random()*5+1),
                W = Math.floor(Math.random()*50+20),
                angle = Math.floor(Math.random()*30+30),
                radians = angle * Math.PI/180,
                T = (W * L/2) / (L * Math.sin(radians));
          return { 
            text: `A beam of length ${L} m and weight ${W} N is supported by a string at ${angle}°. Find the tension in the string.`,
            answer: T.toFixed(1),
            modelAnswer: `We take moments about the support. The weight creates a moment of W×(L/2) and the tension's effective moment arm is L×sin(${angle}°). Thus, T = [W×(L/2)]/(L×sin(${angle}°)) ≈ ${T.toFixed(1)} N.`
          };
        }
      },
      {
        topic: 3, difficulty: "easy", type: "equation",
        question: function() {
          const m1 = 2, m2 = 3, u1 = 3, u2 = 0;
          const vf = (m1 * u1 + m2 * u2) / (m1 + m2);
          return { 
            text: `A ${m1} kg object moving at ${u1} m/s collides inelastically with a ${m2} kg object at rest. Find the final speed of the combined mass.`,
            answer: vf.toFixed(2),
            modelAnswer: `Momentum is conserved in inelastic collisions. Thus, v = (m₁u₁ + m₂u₂)/(m₁+m₂) = (2×3 + 3×0)/(2+3) ≈ ${vf.toFixed(2)} m/s.`
          };
        }
      },
      {
        topic: 3, difficulty: "easy", type: "equation",
        question: function() {
          const m = Math.floor(Math.random()*20+5), a = Math.floor(Math.random()*5+1), F = m * a;
          return { 
            text: `Given a mass of ${m} kg accelerating at ${a} m/s², find the net force acting on it.`,
            answer: F.toFixed(1),
            modelAnswer: `Using F = m × a, we have F = ${m} × ${a} ≈ ${F.toFixed(1)} N.`
          };
        }
      },
      {
        topic: 3, difficulty: "easy", type: "equation",
        question: function() {
          const F_applied = Math.floor(Math.random()*50+50), friction = Math.floor(Math.random()*20+10), netF = F_applied - friction;
          return { 
            text: `A force of ${F_applied} N is applied while friction of ${friction} N opposes it. Find the net force.`,
            answer: netF.toFixed(1),
            modelAnswer: `Net force is given by the difference: ${F_applied} N - ${friction} N = ${netF.toFixed(1)} N.`
          };
        }
      },
      {
        topic: 3, difficulty: "hard", type: "numeric_multi",
        question: function() {
          const m1 = 2, m2 = 3,
                u1 = Math.floor(Math.random()*10+5),
                u2 = Math.floor(Math.random()*10),
                v1 = ((m1 - m2) / (m1 + m2)) * u1 + ((2 * m2) / (m1 + m2)) * u2;
          return { 
            text: `In an elastic collision, a ${m1} kg object moving at ${u1} m/s collides with a ${m2} kg object moving at ${u2} m/s. Find the final speed of the ${m1} kg object.`,
            answer: v1.toFixed(2),
            modelAnswer: `In elastic collisions, both momentum and kinetic energy are conserved. Using the formula v₁ = ((m₁-m₂)/(m₁+m₂))×u₁ + (2×m₂/(m₁+m₂))×u₂, we obtain v₁ ≈ ${v1.toFixed(2)} m/s.`
          };
        }
      },
      {
        topic: 3, difficulty: "hard", type: "numeric_multi",
        question: function() {
          const m1 = 2, m2 = 3, v1i = 5, v1f = 3, theta1 = 30;
          const v1fx = v1f * Math.cos(theta1 * Math.PI/180);
          const v1fy = v1f * Math.sin(theta1 * Math.PI/180);
          const p_initial_x = m1 * v1i;
          const p1x = m1 * v1fx;
          const v2fx = (p_initial_x - p1x) / m2;
          const v2fy = - (m1 * v1fy) / m2;
          const v2f = Math.sqrt(v2fx*v2fx + v2fy*v2fy);
          const theta2 = Math.atan2(v2fy, v2fx) * (180/Math.PI);
          return { 
            text: `A 2 kg ball at 5 m/s collides with a 3 kg ball at rest. After the collision, the 2 kg ball moves at 3 m/s at 30° above horizontal. Calculate: (a) the speed of the 3 kg ball, (b) its angle (negative if below horizontal).`,
            answer: [v2f.toFixed(2), theta2.toFixed(2)],
            modelAnswer: [
              `Using conservation of momentum in the horizontal direction and resolving into components, we find the resultant speed of the 3 kg ball to be approximately ${v2f.toFixed(2)} m/s.`,
              `The angle is determined by taking the arctan of the vertical over horizontal components, yielding approximately ${theta2.toFixed(2)}°.`
            ]
          };
        }
      },
      {
        topic: 3, difficulty: "easy", type: "definition",
        question: "State Newton’s First Law of Motion.",
        modelAnswer: "Newton's First Law states that a body remains at rest or in uniform motion unless acted upon by a net force.",
        keywords: [["remains at rest", "constant motion"], ["no net force", "unopposed"]]
      },
      {
        topic: 3, difficulty: "easy", type: "definition",
        question: "State Newton’s Second Law of Motion.",
        modelAnswer: "Newton's Second Law states The resultant force acting on an object is proportional to the rate of change of momentum p=mv of the object",
        keywords: [["rate of change", "change per unit time", "change over time"], ["momentum"]]
      },
      {
        topic: 3, difficulty: "easy", type: "definition",
        question: "State Newton’s Third Law of Motion.",
        modelAnswer: "Newton's Third Law states that for every action there is an equal and opposite reaction.",
        keywords: [["equal"], ["opposite"]]
      },
      {
        topic: 3, difficulty: "easy", type: "definition",
        question: "Define inertia.",
        modelAnswer: "Inertia is the tendency of an object to resist any change in its state of motion.",
        keywords: [["tendency", "ability to"], ["resist"], ["change in motion"]]
      },
      
      // --- Topic 4: Forces, density and pressure ---
      {
        topic: 4, difficulty: "easy", type: "equation",
        question: function() {
          const h = Math.floor(Math.random()*10+5),
                rho = 1000, g = 9.8,
                pressure = rho * g * h;
          return { 
            text: `Calculate the hydrostatic pressure at a depth of ${h} m in water (density 1000 kg/m³).`,
            answer: pressure.toFixed(0),
            modelAnswer: `Using P = ρgh with ρ = 1000 kg/m³, g = 9.8 m/s², and h = ${h} m, we get P ≈ ${pressure.toFixed(0)} Pa.`
          };
        }
      },
      {
        topic: 4, difficulty: "easy", type: "equation",
        question: function() {
          const V = Math.floor(Math.random()*100+100),
                rho = 1000, g = 9.8,
                V_m3 = V / 1e6,
                F_b = rho * g * V_m3;
          return { 
            text: `An object displaces ${V} cm³ of water. Calculate the buoyant force acting on it.`,
            answer: F_b.toFixed(2),
            modelAnswer: `Buoyant force is given by F_b = ρgV. Converting ${V} cm³ to m³ gives V = ${V}/1e6 m³, so F_b ≈ ${F_b.toFixed(2)} N.`
          };
        }
      },
      {
        topic: 4, difficulty: "easy", type: "equation",
        question: function() {
          const A = Math.floor(Math.random()*50+50),
                h = Math.floor(Math.random()*4+2),
                rho = 1000, g = 9.8,
                A_m2 = A / 10000,
                F = rho * g * h * A_m2;
          return { 
            text: `A container with a base area of ${A} cm² is filled with water to a height of ${h} m. Calculate the force on the base.`,
            answer: F.toFixed(1),
            modelAnswer: `Force on the base is F = ρghA. Converting ${A} cm² to m² gives A = ${A}/10000 m². Thus, F ≈ ${F.toFixed(1)} N.`
          };
        }
      },
      {
        topic: 4, difficulty: "easy", type: "definition",
        question: "Define pressure.",
        modelAnswer: "Pressure is the force exerted per unit area.",
        keywords: [["force"],,["divided by area","per unit area", "over unit area",]]
      },
      {
        topic: 4, difficulty: "easy", type: "definition",
        question: "Define density.",
        modelAnswer: "Density is defined as the mass of a substance per unit volume.",
        keywords: [["mass"], ["per unit volume", "divided by volume", "over unit volume]]
      },
      {
        topic: 4, difficulty: "hard", type: "numeric_multi",
        question: function() {
          const area_cm2 = 500, height = 2.5, rho = 1000, g = 9.8,
                area_m2 = area_cm2 / 10000,
                pressure = rho * g * height,
                extra = 0.1 * pressure,
                extraForce = extra * area_m2;
          return { 
            text: `A container with a base area of ${area_cm2} cm² and water height ${height} m. Calculate: (a) the hydrostatic pressure and (b) the extra force required for a 10% increase in pressure.`,
            answer: [pressure.toFixed(0) + " Pa", extraForce.toFixed(2) + " N"],
            modelAnswer: [
              `Pressure = ρgh = 1000×9.8×${height} ≈ ${pressure.toFixed(0)} Pa.`,
              `A 10% increase means an extra pressure of 0.1×P. The extra force is this extra pressure multiplied by the area: extra force ≈ ${extraForce.toFixed(2)} N.`
            ]
          };
        }
      },
      
      // --- Topic 5: Work, energy and power ---
      {
        topic: 5, difficulty: "easy", type: "equation",
        question: function() {
          const m = Math.floor(Math.random()*10+1),
                v = Math.floor(Math.random()*10+1),
                KE = 0.5 * m * v * v;
          return { 
            text: `Calculate the kinetic energy of a ${m} kg object moving at ${v} m/s.`,
            answer: KE.toFixed(1),
            modelAnswer: `Kinetic energy is given by KE = ½mv². Substituting m = ${m} kg and v = ${v} m/s, KE ≈ ${KE.toFixed(1)} J.`
          };
        }
      },
      {
        topic: 5, difficulty: "easy", type: "equation",
        question: function() {
          const m = Math.floor(Math.random()*10+1),
                h = Math.floor(Math.random()*10+1),
                g = 9.8,
                GPE = m * g * h;
          return { 
            text: `A ${m} kg object is raised ${h} m. Calculate its gravitational potential energy.`,
            answer: GPE.toFixed(1),
            modelAnswer: `Gravitational potential energy is given by GPE = mgh. Therefore, GPE = ${m}×9.8×${h} ≈ ${GPE.toFixed(1)} J.`
          };
        }
      },
      {
        topic: 5, difficulty: "easy", type: "equation",
        question: function() {
          const W = Math.floor(Math.random()*200+100),
                t = Math.floor(Math.random()*10+1),
                P = W / t;
          return { 
            text: `If ${W} J of work is done in ${t} s, calculate the power output.`,
            answer: P.toFixed(1),
            modelAnswer: `Power = Work / Time = ${W} J / ${t} s ≈ ${P.toFixed(1)} W.`
          };
        }
      },
      {
        topic: 5, difficulty: "easy", type: "equation",
        question: function() {
          const F = Math.floor(Math.random()*50+50),
                d = Math.floor(Math.random()*10+5),
                work = F * d;
          return { 
            text: `A force of ${F} N moves an object through ${d} m. Calculate the work done.`,
            answer: work.toFixed(1),
            modelAnswer: `Work = Force × Distance = ${F} N × ${d} m = ${work.toFixed(1)} J.`
          };
        }
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "State what is meant by the work done by a force.",
        modelAnswer: "Work is done when a force causes an object to move in the direction of the force.",
        keywords: [["force"], ["move", "displacement", "movement"], ["direction"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Define power.",
        modelAnswer: "Power is the rate at which work is done or energy is transferred.",
        keywords: [["rate"], ["work"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of power to determine its SI base units.",
        modelAnswer: "Power (in watts, W) is defined as work per unit time, so its SI base units are kg·m²/s³.",
        keywords: [["kg"], ["m²", "m2", "m^2"], ["s^-3", "s-3", "per s3", "per s^3"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of work to determine its SI base units.",
        modelAnswer: "Work (in joules, J) is the product of force and distance, so its SI base units are kg·m²/s².",
        keywords: [["kg"], ["m²", "m2", "m^2"], ["s^-2", "s-2", "per s2", "per s^2"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of force (F = m·a) to determine its SI base units.",
        modelAnswer: "Force (in newtons, N) is defined as mass times acceleration, so its SI base units are kg·m/s².",
        keywords: [["kg"], ["m/s²", "m/s^2", "m s^-2"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of pressure (P = F/A) to determine its SI base units.",
        modelAnswer: "Pressure is force per unit area, so its SI base units are kg/(m·s²), which are also called pascals (Pa).",
        keywords: [["kg"], ["m"], ["s^-2", "s-2", "per s2", "per s^2"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of momentum (p = m·v) to determine its SI base units.",
        modelAnswer: "Momentum is the product of mass and velocity, so its SI base units are kg·m/s.",
        keywords: [["kg"], ["m/s", "m s^-1"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of strain to determine its SI base units.",
        modelAnswer: "Strain is a ratio of lengths and is therefore dimensionless (it has no units).",
        keywords: [["dimensionless"], ["no units"]]
      },
      {
        topic: 5, difficulty: "hard", type: "numeric_multi",
        question: function() {
          const Vin = 9.0, R_fixed = 1800, V_fixed = 5.4;
          const I = V_fixed / R_fixed;
          const V_LDR = Vin - V_fixed;
          const R_LDR = V_LDR / I;
          return { 
            text: `A ${Vin} V battery (negligible internal resistance) is connected in series with an LDR and a ${R_fixed} Ω resistor. A voltmeter across the fixed resistor reads ${V_fixed} V. Calculate: (a) the current and (b) the resistance of the LDR.`,
            answer: [I.toFixed(3) + " A", R_LDR.toFixed(0) + " Ω"],
            modelAnswer: [
              `Using Ohm's law on the fixed resistor: I = V_fixed / R_fixed = ${V_fixed} V / ${R_fixed} Ω ≈ ${I.toFixed(3)} A.`,
              `The voltage across the LDR is Vin - V_fixed. Therefore, its resistance is R_LDR = (Vin - V_fixed) / I ≈ ${R_LDR.toFixed(0)} Ω.`
            ]
          };
        }
      },
      
      // --- Topic 6: Deformation of solids ---
      {
        topic: 6, difficulty: "easy", type: "equation",
        question: function() {
          const stress = Math.floor(Math.random()*10+5),
                strain = Math.random()*0.01+0.001,
                E = stress / strain;
          return { 
            text: `A material has a stress of ${stress} MPa and a strain of ${strain.toFixed(4)}. Calculate its Young's modulus in GPa.`,
            answer: (E/1000).toFixed(2),
            modelAnswer: `Young's modulus E = stress/strain. Here, E = ${stress} MPa / ${strain.toFixed(4)} ≈ ${(E).toFixed(2)} MPa, which is ${(E/1000).toFixed(2)} GPa.`
          };
        }
      },
      {
        topic: 6, difficulty: "easy", type: "equation",
        question: function() {
          const k = Math.floor(Math.random()*200+100),
                F = Math.floor(Math.random()*50+10),
                extension = F / k;
          return { 
            text: `A spring with a constant of ${k} N/m is pulled by a force of ${F} N. Calculate its extension.`,
            answer: extension.toFixed(3),
            modelAnswer: `Hooke's Law states that extension = F/k. Therefore, extension = ${F} N / ${k} N/m ≈ ${extension.toFixed(3)} m.`
          };
        }
      },
      {
        topic: 6, difficulty: "easy", type: "equation",
        question: function() {
          const L0 = Math.floor(Math.random()*50+50),
                ext = (Math.floor(Math.random()*5+1)) / 100,
                strain = ext / (L0 / 100);
          return { 
            text: `A rod of original length ${L0} cm is extended by ${ext.toFixed(2)} m. Calculate the strain.`,
            answer: strain.toFixed(3),
            modelAnswer: `Strain = extension/original length. Convert ${L0} cm to ${L0/100} m, so strain = ${ext.toFixed(2)} / (${L0/100}) ≈ ${strain.toFixed(3)} (dimensionless).`
          };
        }
      },
      {
        topic: 6, difficulty: "easy", type: "definition",
        question: "State Hooke's Law.",
        modelAnswer: "Hooke's Law states that, within the elastic limit, the extension of a spring is directly proportional to the applied force.",
        keywords: [["extension", "stretch"], ["proportional"], ["force"]]
      },
      {
        topic: 6, difficulty: "easy", type: "definition",
        question: "Define stress.",
        modelAnswer: "Stress is the force applied per unit cross-sectional area of a material.",
        keywords: [["force"], ["per unit cross-sectional area", "per unit area","divided by area", "divided by cros-sectional area"]]
      },
      {
        topic: 6, difficulty: "easy", type: "definition",
        question: "Define strain.",
        modelAnswer: "Strain is the ratio of the extension of a material to its original length.",
        keywords: [["ratio"], ["extension"], ["original length"]]
      },
      {
        topic: 6, difficulty: "hard", type: "numeric_multi",
        question: function() {
          const length = 2, area = 1e-4, force = 10000, E = 200e9;
          const stress = force / area;
          const strain = stress / E;
          const elongation = length * strain;
          return { 
            text: `A rod of length ${length} m and area ${area} m² is subjected to a force of ${force} N. With Young's modulus E = ${E/1e9} GPa, calculate: (a) the stress in Pa, (b) the strain, and (c) the elongation in m.`,
            answer: [stress.toExponential(2) + " Pa", strain.toExponential(2), elongation.toExponential(2) + " m"],
            modelAnswer: [
              `Stress = force / area = ${force} N / ${area} m² ≈ ${stress.toExponential(2)} Pa.`,
              `Strain = stress / E = ${stress.toExponential(2)} / ${E} ≈ ${strain.toExponential(2)} (dimensionless).`,
              `Elongation = original length × strain = ${length} m × ${strain.toExponential(2)} ≈ ${elongation.toExponential(2)} m.`
            ]
          };
        }
      },
      
      // --- Topic 7: Waves ---
      {
        topic: 7, difficulty: "easy", type: "equation",
        question: function() {
          const n = Math.floor(Math.random()*3+1),
                L = Math.floor(Math.random()*3+1),
                v = Math.floor(Math.random()*200+100),
                f = (n * v) / (2 * L);
          return { 
            text: `A pipe closed at both ends with length ${L} m and wave speed ${v} m/s vibrates in its ${ordinalSuffix(n)} harmonic. Find its frequency.`,
            answer: f.toFixed(1),
            modelAnswer: `For a pipe closed at both ends, frequency f = n×v/(2L). Substituting the values gives f ≈ ${f.toFixed(1)} Hz.`
          };
        }
      },
      {
        topic: 7, difficulty: "easy", type: "equation",
        question: function() {
          const d = (Math.floor(Math.random()*4+1)) / 1000,
                D = Math.floor(Math.random()*100+100),
                x = (Math.floor(Math.random()*20+10)) / 1000,
                lambda = (d * x) / (D / 100);
          return { 
            text: `In a double-slit experiment with a slit separation of ${(d*1000).toFixed(1)} mm, screen distance ${D} cm, and fringe spacing ${(x*1000).toFixed(1)} mm, calculate the wavelength in nm.`,
            answer: (lambda * 1e9).toFixed(1),
            modelAnswer: `Using λ = (d×x)/(D/100), substituting the values gives λ ≈ ${(lambda*1e9).toFixed(1)} nm.`
          };
        }
      },
      {
        topic: 7, difficulty: "easy", type: "equation",
        question: function() {
          const L = Math.floor(Math.random()*3+1),
                v = Math.floor(Math.random()*100+300),
                f = v / (2 * L),
                T = 1 / f;
          return { 
            text: `A pipe open at both ends with length ${L} m and sound speed ${v} m/s vibrates. (a) Find the fundamental frequency and (b) the time period.`,
            answer: [f.toFixed(1), T.toFixed(3)],
            modelAnswer: `For a pipe open at both ends, the fundamental frequency is f = v/(2L). Thus, f = ${v}/(2×${L}) ≈ ${f.toFixed(1)} Hz, and the period T = 1/f ≈ ${T.toFixed(3)} s.`,
            type:"numeric_multi",
            multi:true
          };
        }
      },
      {
        topic: 7, difficulty: "easy", type: "definition",
        question: "Define wavelength.",
        modelAnswer: "Wavelength is the distance between successive points on a wave that are in phase.",
        keywords: [["distance"], ["successive"], ["in phase", "phase"]]
      },
      {
        topic: 7, difficulty: "easy", type: "definition",
        question: "Define frequency.",
        modelAnswer: "Frequency is the number of oscillations (or cycles) per second.",
        keywords: [["oscillations", "cycles", "vibrations"], ["per second", "Hz"]]
      },
      {
        topic: 7, difficulty: "easy", type: "definition",
        question: "Define wavefront.",
        modelAnswer: "A wavefront is a line connecting points on a wave that are in the same phase.",
        keywords: [["line"], ["equal phase", "same phase", "connecting"]]
      },
      {
        topic: 7, difficulty: "hard", type: "numeric_multi",
        question: function() {
          const L = 2, v = 305, f = v/(4 * L), T = 1 / f;
          return { 
            text: `A pipe closed at one end with length ${L} m and sound speed ${v} m/s vibrates. Calculate: (a) the fundamental frequency, (b) the time period, and (c) verify that f×T ≈ 1.`,
            answer: [f.toFixed(1), T.toFixed(3), (f*T).toFixed(2)],
            modelAnswer: [
              `For a pipe closed at one end, the fundamental frequency is f = v/(4L). Substituting gives f ≈ ${f.toFixed(1)} Hz.`,
              `The time period is T = 1/f ≈ ${T.toFixed(3)} s.`,
              `Multiplying f and T, we get f×T ≈ ${(f*T).toFixed(2)}, which should be approximately 1.`
            ],
            multi:true
          };
        }
      },
      
      // --- Topic 8: Superposition ---
      {
        topic: 8, difficulty: "easy", type: "equation",
        question: function() {
          const A1 = Math.floor(Math.random()*5+5),
                A2 = Math.floor(Math.random()*5+5),
                result = A1 + A2;
          return { 
            text: `Two waves with amplitudes ${A1} and ${A2} add constructively. Find the resultant amplitude.`,
            answer: result.toFixed(1),
            modelAnswer: `In constructive interference, amplitudes add: ${A1} + ${A2} = ${result}.`
          };
        }
      },
      {
        topic: 8, difficulty: "easy", type: "equation",
        question: function() {
          const A1 = Math.floor(Math.random()*5+5),
                A2 = Math.floor(Math.random()*5+1),
                result = Math.abs(A1 - A2);
          return { 
            text: `Two waves with amplitudes ${A1} and ${A2} combine destructively. Find the resultant amplitude.`,
            answer: result.toFixed(1),
            modelAnswer: `In destructive interference, the resultant amplitude is the absolute difference: |${A1} - ${A2}| = ${result}.`
          };
        }
      },
      {
        topic: 8, difficulty: "easy", type: "definition",
        question: "State the principle of superposition.",
        modelAnswer: "The principle of superposition states that when waves overlap, the resultant displacement is the sum of the individual displacements.",
        keywords: [["sum", "total"], ["displacement", "overlap"]]
      },
      {
        topic:8, difficulty: "easy', type: "definition",
        question: "define diffraction.",
        modelAnswer: "The the spreading out of waves when they pass through a gap, or around an obstacle",
        keywords: [["spreading out", "bending"], ["through a gap", "obstacle"]]
      {
        topic: 8, difficulty: "easy", type: "definition",
        question: "Define constructive interference.",
        modelAnswer: "Constructive interference occurs when waves in phase add together, increasing the overall amplitude.",
        keywords: [["in phase"], ["add", "reinforce", "increase"]]
      },
      {
        topic: 8, difficulty: "easy", type: "definition",
        question: "Define destructive interference.",
        modelAnswer: "Destructive interference occurs when waves are out of phase, causing them to cancel each other out.",
        keywords: [["out of phase"], ["cancel", "reduce"]]
      },
      
      // --- Topic 9: Electricity ---
      {
        topic: 9, difficulty: "easy", type: "equation",
        question: function() {
          const I = Math.floor(Math.random()*5+1),
                R = Math.floor(Math.random()*20+10),
                V = I * R;
          return { 
            text: `A current of ${I} A flows through a ${R} Ω resistor. Find the voltage across it.`,
            answer: V.toFixed(1),
            modelAnswer: `Using Ohm's law (V = I×R), V = ${I}×${R} ≈ ${V.toFixed(1)} V.`
          };
        }
      },
      {
        topic: 9, difficulty: "easy", type: "equation",
        question: function() {
          const V = Math.floor(Math.random()*20+10),
                I = Math.floor(Math.random()*5+1),
                P = V * I;
          return { 
            text: `Find the power for a circuit with a voltage of ${V} V and a current of ${I} A.`,
            answer: P.toFixed(1),
            modelAnswer: `Power P = V × I = ${V} × ${I} ≈ ${P.toFixed(1)} W.`
          };
        }
      },
      {
        topic: 9, difficulty: "easy", type: "equation",
        question: function() {
          const R1 = Math.floor(Math.random()*20+10),
                R2 = Math.floor(Math.random()*20+10),
                R3 = Math.floor(Math.random()*20+10),
                Rp = 1/(1/R1+1/R2),
                R_total = Rp + R3;
          return { 
            text: `Calculate the total resistance of two resistors (${R1} Ω and ${R2} Ω) in parallel, in series with a ${R3} Ω resistor.`,
            answer: R_total.toFixed(1),
            modelAnswer: `For resistors in parallel, R_parallel = 1/(1/${R1} + 1/${R2}) ≈ ${Rp.toFixed(1)} Ω. Adding the series resistor gives R_total ≈ ${Rp.toFixed(1)} + ${R3} = ${R_total.toFixed(1)} Ω.`
          };
        }
      },
      {
        topic: 9, difficulty: "easy", type: "definition",
        question: "Define electric current.",
        modelAnswer: "Electric current is the rate of flow of electric charge through a conductor.",
        keywords: [["rate", "flow"], ["charge"]]
      },
      {
        topic: 9, difficulty: "easy", type: "definition",
        question: "Define electromotive force (e.m.f.).",
        modelAnswer: "Electromotive force (e.m.f.) is the energy provided per unit charge by a source, measured in volts.",
        keywords: [["work done"], ["per unit charge"]]
      },
      {
        topic: 9, difficulty: "easy", type: "definition",
        question: "Define electric potential difference.",
        modelAnswer: "Electric potential difference is the work required per unit charge to move a charge between two points.",
        keywords: [["work", "work done"], ["per unit charge"], ["between two points"]]
      },
      {
        topic: 9, difficulty: "hard", type: "numeric_multi",
        question: function() {
          const R = 10, Vin = 12, I1 = Vin / R, P1 = I1 * I1 * R,
                R_series = 10, newTotal = R + R_series, I2 = Vin / newTotal;
          return { 
            text: `A resistor of ${R} Ω is connected to a ${Vin} V battery. Calculate: (a) the current, (b) the power, and (c) the new current if a ${R_series} Ω resistor is added in series.`,
            answer: [I1.toFixed(2) + " A", P1.toFixed(1) + " W", I2.toFixed(2) + " A"],
            modelAnswer: [
              `Using Ohm's law, current I = V / R = ${Vin} / ${R} ≈ ${I1.toFixed(2)} A.`,
              `Power is P = I² × R = (${I1.toFixed(2)})² × ${R} ≈ ${P1.toFixed(1)} W.`,
              `After adding a resistor, total resistance = ${R} + ${R_series} = ${newTotal} Ω, so new current I = ${Vin} / ${newTotal} ≈ ${I2.toFixed(2)} A.`
            ]
          };
        }
      },
      
      // --- Topic 10: D.C. circuits ---
      {
        topic: 10, difficulty: "easy", type: "equation",
        question: function() {
          const R1 = Math.floor(Math.random()*50+50),
                R2 = Math.floor(Math.random()*50+50),
                Vin = Math.floor(Math.random()*20+10),
                Vout = Vin * (R2 / (R1 + R2));
          return { 
            text: `In a voltage divider with resistors of ${R1} Ω and ${R2} Ω and an input voltage of ${Vin} V, find the voltage across the ${R2} Ω resistor.`,
            answer: Vout.toFixed(1),
            modelAnswer: `Using the voltage divider formula, V_out = Vin × (R2/(R1+R2)). Substituting, V_out ≈ ${Vout.toFixed(1)} V.`
          };
        }
      },
      {
        topic: 10, difficulty: "easy", type: "equation",
        question: function() {
          const Vin = Math.floor(Math.random()*20+10),
                R_total = Math.floor(Math.random()*100+100),
                I = Vin / R_total;
          return { 
            text: `Find the current in a series circuit with a total resistance of ${R_total} Ω and a supply voltage of ${Vin} V.`,
            answer: I.toFixed(2),
            modelAnswer: `Using I = V / R, with V = ${Vin} V and R = ${R_total} Ω, I ≈ ${I.toFixed(2)} A.`
          };
        }
      },
      {
        topic: 10, difficulty: "easy", type: "equation",
        question: function() {
          const I = Math.floor(Math.random()*5+1),
                R = Math.floor(Math.random()*100+50),
                P = I * I * R;
          return { 
            text: `Calculate the power dissipated in a ${R} Ω resistor with a current of ${I} A.`,
            answer: P.toFixed(1),
            modelAnswer: `Power is given by P = I² × R. So, P = (${I})² × ${R} ≈ ${P.toFixed(1)} W.`
          };
        }
      },
      {
        topic: 10, difficulty: "easy", type: "equation",
        question: function() {
          const R1 = Math.floor(Math.random()*50+50),
                R2 = Math.floor(Math.random()*50+50),
                R3 = Math.floor(Math.random()*50+50),
                R_total = R1 + R2 + R3;
          return { 
            text: `Three resistors of ${R1} Ω, ${R2} Ω, and ${R3} Ω are connected in series. Find the total resistance.`,
            answer: R_total.toFixed(1),
            modelAnswer: `For series resistors, the total resistance is the sum: R_total = ${R1} + ${R2} + ${R3} = ${R_total} Ω.`
          };
        }
      },
      {
        topic: 10, difficulty: "easy", type: "definition",
        question: "Define resistance.",
        modelAnswer: "Resistance is the ratio of the voltage across a conductor to the current flowing through it.",
        keywords: [["voltage"], ["current"], ["ratio"]]
      },
      {
        topic: 10, difficulty: "easy", type: "definition",
        question: "Define internal resistance.",
        modelAnswer: "Internal resistance is the resistance inside a power source that causes a drop in the terminal voltage.",
        keywords: [["internal"], ["power source"], ["resistance"]]
      },
      {
        topic: 10, difficulty: "hard", type: "numeric_multi",
        question: function() {
          const R1 = 100, R2 = 200, R3 = 300, Vin = 12,
                R_total = R1 + R2 + R3,
                I = Vin / R_total,
                V_R2 = I * R2,
                power_R2 = V_R2 * V_R2 / R2;
          return { 
            text: `In a voltage divider with three series resistors (${R1} Ω, ${R2} Ω, ${R3} Ω) and an input voltage of ${Vin} V, calculate: (a) the voltage across the ${R2} Ω resistor and (b) the power dissipated in it.`,
            answer: [V_R2.toFixed(2) + " V", power_R2.toFixed(2) + " W"],
            modelAnswer: [
              `Using the voltage divider rule, V_R2 = Vin × (R2/(R1+R2+R3)) = ${Vin} × (${R2}/(${R1}+${R2}+${R3})) ≈ ${V_R2.toFixed(2)} V.`,
              `Then, power P = V_R2² / R2 = (${V_R2.toFixed(2)})² / ${R2} ≈ ${power_R2.toFixed(2)} W.`
            ]
          };
        }
      },
      
      // --- Topic 11: Particle and nuclear physics ---
      {
        topic: 11, difficulty: "easy", type: "equation",
        question: function() {
          const initialN = Math.floor(Math.random()*50+50);
          return { 
            text: `In β– decay, if a nucleus has a nucleon number of ${initialN}, what is its nucleon number after decay?`,
            answer: initialN.toString(),
            modelAnswer: `Nucleon number is conserved in β– decay. Therefore, it remains ${initialN}.`
          };
        }
      },
      {
        topic: 11, difficulty: "easy", type: "equation",
        question: function() {
          const initialZ = Math.floor(Math.random()*20+10),
                finalZ = initialZ - 1;
          return { 
            text: `A nucleus with a proton number of ${initialZ} undergoes β+ decay. What is its new proton number?`,
            answer: finalZ.toString(),
            modelAnswer: `In β+ decay, one proton is converted, so the new proton number is ${initialZ} - 1 = ${finalZ}.`
          };
        }
      },
      {
        topic: 11, difficulty: "easy", type: "equation",
        question: function() {
          const initialMass = Math.floor(Math.random()*200+100),
                finalMass = initialMass - 4;
          return { 
            text: `A nucleus with a mass number of ${initialMass} undergoes alpha decay. What is its new mass number?`,
            answer: finalMass.toString(),
            modelAnswer: `Alpha decay reduces the mass number by 4, so the new mass number is ${initialMass} - 4 = ${finalMass}.`
          };
        }
      },
      {
        topic: 11, difficulty: "easy", type: "equation",
        question: function() {
          const initialMass = Math.floor(Math.random()*200+100),
                change = 4;
          return { 
            text: `A nucleus with a mass number of ${initialMass} undergoes alpha decay. By how much does its mass number change?`,
            answer: change.toString(),
            modelAnswer: `Alpha decay causes a decrease of 4 in the mass number.`
          };
        }
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define nucleon number.",
        modelAnswer: "Nucleon number is the total number of protons and neutrons in a nucleus.",
        keywords: [["protons"], ["neutrons"], ["total"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define proton number.",
        modelAnswer: "Proton number is the count of protons in a nucleus.",
        keywords: [["nucleus"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define isotope.",
        modelAnswer: "Isotopes are atoms of the same element with the same number of protons but different numbers of neutrons.",
        keywords: [["same element"], ["same protons"], ["different neutrons"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define a hadron.",
        modelAnswer: "A hadron is a composite particle made of quarks that interacts via the strong nuclear force.",
        keywords: [["quarks"], ["strong force"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define a baryon.",
        modelAnswer: "A baryon is a type of hadron composed of three quarks.",
        keywords: [["three quarks", "3 quarks"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define a meson.",
        modelAnswer: "A meson is a hadron composed of a quark and an antiquark.",
        keywords: [["quark"], ["antiquark"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define a lepton.",
        modelAnswer: "A lepton is a fundamental particle that does not participate in the strong nuclear force.",
        keywords: [["fundamental"], ["does not feel", "not affected", "no strong force"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define a quark.",
        modelAnswer: "A quark is a fundamental particle that comes in flavors such as up, down, charm, strange, top, and bottom.",
        keywords: [["up"], ["down"], ["charm"], ["strange"], ["top"], ["bottom"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "State the charges of up and down quarks.",
        modelAnswer: "The up quark has a charge of +2/3 e, while the down quark has a charge of -1/3 e.",
        keywords: [[ "+2/3", "2/3" ], [ "-1/3", "1/3" ]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "State the quark composition of a proton.",
        modelAnswer: "A proton is composed of two up quarks and one down quark (uud).",
        keywords: [[ "2 u", "2 up", "two up", "1 d", "1 down", "uud", "2u1d", "2 up 1 down", "duu", "udu" ]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "State the quark composition of a neutron.",
        modelAnswer: "A neutron is composed of one up quark and two down quarks (udd).",
        keywords: [[ "udd", "1up2down", "dud", "ddu" ]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define an antiparticle.",
        modelAnswer: "An antiparticle is a particle that has the same mass as its corresponding particle but opposite charge.",
        keywords: [["same mass"], ["opposite charge"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "What is emitted during β– decay?",
        modelAnswer: "During β– decay, an electron and an electron antineutrino are emitted.",
        keywords: [["electron"], ["antineutrino"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "What is emitted during β+ decay?",
        modelAnswer: "During β+ decay, a positron and an electron neutrino are emitted.",
        keywords: [["positron"], ["electron neutrino"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define the unified atomic mass unit (u).",
        modelAnswer: "One unified atomic mass unit (u) is defined as 1/12 the mass of a carbon-12 atom.",
        keywords: [["1/12"], ["carbon-12"]]
      },
      {
        topic: 11, difficulty: "hard", type: "numeric_multi",
        question: function() {
          return { 
            text: "A nucleus with mass number 210 and atomic number 84 undergoes β– decay followed by alpha decay. Calculate the final mass number and atomic number.",
            answer: ["206", "83"],
            modelAnswer: ["After β– decay, nucleon number remains 210. Then, alpha decay reduces the mass number by 4 and the atomic number by 2, resulting in a final mass number of 210 - 4 = 206 and a final atomic number of 84 + 1 - 2 = 83."]
          };
        }
      }
    ];
    
    /* -----------------------------
       Difficulty & Topic Filtering
    ----------------------------- */
    function getSelectedDifficulty() {
      const radios = document.getElementsByName("difficulty");
      for (let radio of radios) {
        if (radio.checked) return radio.value;
      }
      return "easy";
    }
    
    function getCheckedTopicModes() {
      const wholeDefs = document.getElementById("whole-defs").checked;
      const wholeEqs = document.getElementById("whole-eqs").checked;
      const topicsArr = [];
      for (let i = 1; i <= 11; i++) {
        const defBox = document.getElementById(`topic${i}-defs`);
        const eqBox = document.getElementById(`topic${i}-eqs`);
        topicsArr.push({
          topic: i,
          defs: defBox ? defBox.checked : false,
          eqs: eqBox ? eqBox.checked : false
        });
      }
      return { topics: topicsArr, wholeDefs, wholeEqs };
    }
    
    function buildQuestionPool() {
      const { topics: topicModes, wholeDefs, wholeEqs } = getCheckedTopicModes();
      const diff = getSelectedDifficulty();
      let filtered = [];
      // Expand the question bank: if q.question is a function, use it; if it's a string, add it as text.
      const expandedBank = questionBank.map(q => {
        if (typeof q.question === "function") {
          const built = q.question();
          return { ...q, text: built.text, answer: built.answer, modelAnswer: built.modelAnswer, image: built.image || null };
        } else {
          return { ...q, text: q.question }; // For definitions
        }
      });
      
      for (let q of expandedBank) {
        let matchedTopicType = false;
        const isDefinition = (q.type === "definition");
        const isEquation = (q.type === "equation" || q.type === "numeric" || q.type === "numeric_multi" || q.type==="numeric_dynamic");
        if (wholeDefs && isDefinition) matchedTopicType = true;
        if (wholeEqs && isEquation) matchedTopicType = true;
        
        const topicSetting = topicModes.find(item => item.topic === q.topic);
        if (!matchedTopicType && topicSetting) {
          if (isDefinition && topicSetting.defs) matchedTopicType = true;
          if (isEquation && topicSetting.eqs) matchedTopicType = true;
        }
        if (matchedTopicType) filtered.push(q);
      }
      
      if (diff === "easy") {
        filtered = filtered.filter(q => q.difficulty === "easy" || !q.difficulty);
      } else if (diff === "hard") {
        filtered = filtered.filter(q => q.difficulty === "hard");
      }
      
      return filtered;
    }
    
    /* -----------------------------
       Practice Flow
    ----------------------------- */
    function startPractice() {
      score = 0;
      document.getElementById("score").innerText = score;
      answeredCurrent = false;
      mixedCount = 0;
      const pool = buildQuestionPool();
      if (pool.length === 0) {
        document.getElementById("question-box").innerText = "No matching questions available yet.";
        return;
      }
      questionPool = pool;
      askNewQuestion();
      document.getElementById("question-box").scrollIntoView({ behavior: 'smooth' });
    }
    
    function askNewQuestion() {
      answeredCurrent = false;
      document.getElementById("feedback").innerText = "";
      if (!questionPool || questionPool.length === 0) {
        document.getElementById("question-box").innerText = "No matching questions available yet.";
        return;
      }
      const diff = getSelectedDifficulty();
      let subset = questionPool;
      if (diff === "mixed") {
        if (mixedCount % 3 < 2) {
          subset = questionPool.filter(q => q.difficulty === "easy" || !q.difficulty);
        } else {
          subset = questionPool.filter(q => q.difficulty === "hard");
        }
        mixedCount++;
      }
      if (subset.length === 0) subset = questionPool;
      const chosen = getRandom(subset);
      loadQuestion(chosen);
    }
    
    function loadQuestion(q) {
      currentQuestion = q;
      answeredCurrent = false;
      document.getElementById("diagramContainer").innerHTML = "";
      document.getElementById("answerInputs").innerHTML = "";
      document.getElementById("feedback").innerText = "";
      document.getElementById("question-box").innerText = "Question: " + q.text;
      if (q.image) {
        document.getElementById("diagramContainer").innerHTML = q.image;
      }
      if (q.type === "definition") {
        const inp = document.createElement("input");
        inp.type = "text";
        inp.id = "answerInput";
        inp.placeholder = "Enter your answer...";
        document.getElementById("answerInputs").appendChild(inp);
        currentAnswers = q.answer ? [q.answer] : q.keywords;
      } else if (q.type === "equation" || q.type === "numeric" || q.type==="numeric_dynamic") {
        const inp = document.createElement("input");
        inp.type = "text";
        inp.id = "answerInput";
        inp.placeholder = "Enter your answer...";
        document.getElementById("answerInputs").appendChild(inp);
        currentAnswers = [q.answer];
      } else if (q.type === "numeric_multi") {
        const inp1 = document.createElement("input");
        inp1.type = "text";
        inp1.id = "answerInput1";
        inp1.placeholder = "Part (a)";
        inp1.style.width = "100px";
        const inp2 = document.createElement("input");
        inp2.type = "text";
        inp2.id = "answerInput2";
        inp2.placeholder = "Part (b)";
        inp2.style.width = "100px";
        inp2.style.marginLeft = "10px";
        document.getElementById("answerInputs").appendChild(inp1);
        document.getElementById("answerInputs").appendChild(inp2);
        if (Array.isArray(q.answer) && q.answer.length === 3) {
          const inp3 = document.createElement("input");
          inp3.type = "text";
          inp3.id = "answerInput3";
          inp3.placeholder = "Part (c)";
          inp3.style.width = "100px";
          inp3.style.marginLeft = "10px";
          document.getElementById("answerInputs").appendChild(inp3);
        }
        currentAnswers = q.answer;
      }
    }
    
    function checkAnswer() {
      if (!currentQuestion || answeredCurrent) return;
      let userAns;
      if (currentQuestion.type === "numeric_multi") {
        const inputs = document.querySelectorAll("#answerInputs input");
        userAns = Array.from(inputs).map(inp => inp.value.trim());
      } else {
        userAns = document.getElementById("answerInput").value.trim();
      }
      let correct = false;
      if (currentQuestion.type === "definition") {
        const ansLower = userAns.toLowerCase();
        correct = true;
        for (let group of currentAnswers) {
          let found = group.some(word => ansLower.includes(word));
          if (!found) { correct = false; break; }
        }
      } else if (currentQuestion.type === "equation" || currentQuestion.type === "numeric" || currentQuestion.type === "numeric_dynamic") {
        const userNum = parseFloat(userAns);
        const correctNum = parseFloat(currentAnswers[0]);
        if (!isNaN(userNum) && Math.abs(userNum - correctNum) < Math.max(0.01 * Math.abs(correctNum), 0.1))
          correct = true;
      } else if (currentQuestion.type === "numeric_multi") {
        correct = true;
        for (let i = 0; i < currentAnswers.length; i++) {
          const userNum = parseFloat(userAns[i]);
          const correctNum = parseFloat(currentAnswers[i]);
          if (isNaN(userNum) || Math.abs(userNum - correctNum) > Math.max(0.01 * Math.abs(correctNum), 0.1)) {
            correct = false;
            break;
          }
        }
      }
      const fb = document.getElementById("feedback");
      if (correct) {
        fb.innerText = "✔ Correct!";
        score++;
        document.getElementById("score").innerText = score;
      } else {
        fb.innerText = "✘ Not quite correct.";
      }
      answeredCurrent = true;
    }
    
    function showModelAnswer() {
      if (!currentQuestion) return;
      let modelText = "Model Answer: ";
      if (currentQuestion.type === "numeric_multi") {
        if (Array.isArray(currentQuestion.modelAnswer))
          modelText += currentQuestion.modelAnswer.join(" | ");
        else modelText += currentQuestion.modelAnswer;
      } else {
        modelText += currentQuestion.modelAnswer;
      }
      document.getElementById("feedback").innerText = modelText;
      answeredCurrent = true;
    }
    
    // Create buttons for Check, Show, and Next Question
    const checkBtn = document.createElement("button");
    checkBtn.innerText = "Check Answer";
    checkBtn.style.marginRight = "10px";
    checkBtn.onclick = checkAnswer;
    document.getElementById("question-box").parentNode.insertBefore(checkBtn, document.getElementById("question-box").nextSibling);
    
    const showBtn = document.createElement("button");
    showBtn.innerText = "Show Model Answer";
    showBtn.style.marginRight = "10px";
    showBtn.onclick = showModelAnswer;
    checkBtn.parentNode.insertBefore(showBtn, checkBtn.nextSibling);
    
    const nextBtn = document.createElement("button");
    nextBtn.innerText = "Next Question";
    nextBtn.onclick = askNewQuestion;
    showBtn.parentNode.insertBefore(nextBtn, showBtn.nextSibling);
    
    // Shortcuts for UI elements
    const questionBox = document.getElementById("question-box");
    const answerInputs = document.getElementById("answerInputs");
    const feedback = document.getElementById("feedback");
    const scoreDisplay = document.getElementById("score");
    const diagramContainer = document.getElementById("diagramContainer");
    
    // On page load, generate topic checkboxes.
    generateTopicCheckboxes();
  </script>
</body>
</html>
