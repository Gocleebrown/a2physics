<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Physics Practice Hub</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #eef2f3;
      margin-right: 250px; /* reserve space for difficulty panel */
    }
    h1, h2, h3 { color: #333; }
    .section { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
    .topics-grid { display: flex; flex-wrap: wrap; gap: 20px; }
    .topic-column { flex: 1 1 300px; }
    label { display: block; margin: 5px 0; }
    button { margin-top: 20px; padding: 10px 15px; font-size: 1em; }
    #question-box {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      margin-top: 30px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #score-box { font-weight: bold; margin-top: 10px; }
    .question-img { max-width: 100%; height: auto; margin: 10px 0; }
    /* Difficulty panel */
    #difficulty-container {
      position: fixed;
      top: 100px;
      right: 20px;
      width: 200px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #difficulty-container h3 { margin-top: 0; }
  </style>
</head>
<body>
  <h1>Cambridge Physics 9702 Practice Hub</h1>
  
  <!-- Whole Course Section -->
  <div class="section">
    <h2>Whole Course</h2>
    <label><input type="checkbox" id="whole-defs" onchange="toggleByGroup('defs', this.checked)"> Definitions</label>
    <label><input type="checkbox" id="whole-eqs" onchange="toggleByGroup('eqs', this.checked)"> Equations</label>
    <button onclick="startPractice()">Start Practice</button>
  </div>
  
  <!-- By Topic Section -->
  <div class="section">
    <h2>By Topic</h2>
    <div class="topics-grid">
      <div class="topic-column" id="topic-columns-left"></div>
      <div class="topic-column" id="topic-columns-right"></div>
    </div>
  </div>
  
  <!-- Additional Start Practice Button -->
  <div class="section">
    <button onclick="startPractice()">Start Practice</button>
  </div>
  
  <div id="score-box">Score: <span id="score">0</span></div>
  <div id="question-box"></div>
  
  <!-- Difficulty Panel -->
  <div id="difficulty-container">
    <h3>Select Difficulty</h3>
    <input type="radio" name="difficulty" id="difficulty-go-easy" value="easy" checked>
    <label for="difficulty-go-easy">Go Easy</label><br>
    <input type="radio" name="difficulty" id="difficulty-im-getting-there" value="mixed">
    <label for="difficulty-im-getting-there">I'm Getting There</label><br>
    <input type="radio" name="difficulty" id="difficulty-hard" value="hard">
    <label for="difficulty-hard">Hard</label><br>
  </div>
  
  <script>
    // Global variables
    let answeredCurrent = false;
    let currentQuestion = null;
    let currentAnswers = null;
    let currentMode = null;
    let mixedCount = 0;
    let score = 0;
    
    // Utility: Ordinal suffix for numbers (for harmonic questions)
    function ordinalSuffix(n) {
      let j = n % 10, k = n % 100;
      if (j === 1 && k !== 11) return n + "st";
      if (j === 2 && k !== 12) return n + "nd";
      if (j === 3 && k !== 13) return n + "rd";
      return n + "th";
    }
    
    // Utility: Pick random element from array
    function getRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }
    
    // Inline SVG for slope questions (geometry fixed, text labels dynamic)
    function createSlopeSVG(mass, angle, distance) {
      return `
      <svg width="300" height="200" class="question-img" style="border:1px solid #ccc">
        <line x1="50" y1="150" x2="200" y2="50" stroke="orange" stroke-width="2" />
        <rect x="190" y="40" width="20" height="20" fill="brown" />
        <text x="125" y="100" fill="blue" font-size="12" text-anchor="middle">Distance = ${distance} m</text>
        <text x="200" y="40" fill="red" font-size="12" text-anchor="start">Mass = ${mass} kg</text>
        <text x="55" y="140" fill="green" font-size="12" text-anchor="start">Angle = ${angle}°</text>
      </svg>`;
    }
    
    // Topics array (11 topics)
    const topics = [
      "Physical quantities and units",
      "Kinematics",
      "Dynamics",
      "Forces, density and pressure",
      "Work, energy and power",
      "Deformation of solids",
      "Waves",
      "Superposition",
      "Electricity",
      "D.C. circuits",
      "Particle and nuclear physics"
    ];
    
    // Generate topic checkboxes in two columns
    function generateTopicCheckboxes() {
      const left = document.getElementById("topic-columns-left");
      const right = document.getElementById("topic-columns-right");
      topics.forEach((name, i) => {
        const topicNum = i + 1;
        const block = `
          <h3>${topicNum}. ${name}</h3>
          <label><input type="checkbox" id="topic${topicNum}-defs"> Definitions</label>
          <label><input type="checkbox" id="topic${topicNum}-eqs"> Equations</label>
        `;
        if (i % 2 === 0) left.innerHTML += block; else right.innerHTML += block;
      });
    }
    
    // Toggle checkboxes for a given type
    function toggleByGroup(typeSuffix, isChecked) {
      const boxes = document.querySelectorAll(`input[id$="-${typeSuffix}"]`);
      boxes.forEach(box => box.checked = isChecked);
    }
    
    // Full Question Bank
    const questionBank = [
      // --- Topic 1: Physical quantities and units ---
      {
        topic: 1, difficulty: "easy", type: "equation",
        question: function() { const km = 3.2, m = km * 1000; return { text: `Convert ${km} km to meters.`, answer: m.toFixed(0), modelAnswer: `${km} km = ${m} m.` }; }
      },
      {
        topic: 1, difficulty: "easy", type: "equation",
        question: function() { const grams = 5000, kg = grams/1000; return { text: `Express ${grams} g in kilograms.`, answer: kg.toFixed(1), modelAnswer: `${grams} g = ${kg} kg.` }; }
      },
      {
        topic: 1, difficulty: "easy", type: "equation",
        question: function() { const km = 60, hr = 1, mps = (km*1000)/(hr*3600); return { text: `A car travels ${km} km in ${hr} hour. What is its speed (m/s)?`, answer: mps.toFixed(2), modelAnswer: `Speed = ${mps.toFixed(2)} m/s.` }; }
      },
      {
        topic: 1, difficulty: "easy", type: "equation",
        question: function() { const mass_g = 2000, volume_cm3 = 500, density = (mass_g/1000)/(volume_cm3/1e6); return { text: `Find density of a substance with ${mass_g} g and ${volume_cm3} cm³.`, answer: density.toFixed(0), modelAnswer: `Density ≈ ${density.toFixed(0)} kg/m³.` }; }
      },
      // Definitions Topic 1
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define a scalar quantity.",
        modelAnswer: "A scalar quantity has magnitude only and no direction.",
        keywords: [["magnitude", "size", "value"], ["no direction", "without direction", "directionless"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define a vector quantity.",
        modelAnswer: "A vector quantity has both magnitude and direction.",
        keywords: [["magnitude", "size", "value"], ["direction", "oriented"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define SI base quantity.",
        modelAnswer: "A base quantity is defined independently and is used to derive other quantities.",
        keywords: [["independent", "without reference"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define random error.",
        modelAnswer: "A random error is an unpredictable variation in measurement.",
        keywords: [["unpredictable", "random"], ["variation", "fluctuation"], ["measurement", "reading"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define systematic error.",
        modelAnswer: "A systematic error is a consistent error that skews measurements in the same direction.",
        keywords: [["consistent", "repeated", "constant"], ["error", "bias"], ["same direction", "same each time"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define precision.",
        modelAnswer: "Precision refers to how close repeated measurements are to each other.",
        keywords: [["consistency", "repeatability", "precision"], ["close", "near", "similar", "together", "repeated measurements"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define accuracy.",
        modelAnswer: "Accuracy indicates how close a measurement is to the true value.",
        keywords: [["accuracy", "accurate", "closeness"], ["true value", "actual value", "correct value"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define absolute uncertainty.",
        modelAnswer: "Absolute uncertainty is the margin of uncertainty in a measurement.",
        keywords: [["uncertainty", "error"], ["margin", "amount"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Define percentage uncertainty.",
        modelAnswer: "Percentage uncertainty is the absolute uncertainty expressed as a percentage of the measured value.",
        keywords: [["percentage", "percent"], ["uncertainty", "error"], ["absolute", "real error"]]
      },
      {
        topic: 1, difficulty: "easy", type: "definition",
        question: "Explain how to combine uncertainties for multiplication and division.",
        modelAnswer: "When multiplying or dividing, add the percentage uncertainties.",
        keywords: [["add", "sum"], ["percentage uncertainty"]]
      },
      {
        topic: 1, difficulty: "hard", type: "equation",
        question: function() { const length = 1.20, uncertainty = 0.02; const perc = (uncertainty/length)*100; return { text: `Calculate the percentage uncertainty for ${length} m ± ${uncertainty} m.`, answer: perc.toFixed(2) + " %", modelAnswer: `Percentage uncertainty ≈ ${perc.toFixed(2)} %.` }; }
      },
      
      // --- Topic 2: Kinematics ---
      {
        topic: 2, difficulty: "easy", type: "equation",
        question: function() { const u = Math.floor(Math.random()*10+5), a = Math.floor(Math.random()*4+1), t = Math.floor(Math.random()*4+2), s = u*t + 0.5*a*t*t; return { text: `A body starts at ${u} m/s, accelerates at ${a} m/s² for ${t} s. Find displacement.`, answer: s.toFixed(1), modelAnswer: `Displacement ≈ ${s.toFixed(1)} m.` }; }
      },
      {
        topic: 2, difficulty: "easy", type: "equation",
        question: function() { const m = Math.floor(Math.random()*20+5), angle = Math.floor(Math.random()*30+10), d = Math.floor(Math.random()*10+2), g = 9.8, a = g*Math.sin(angle*Math.PI/180), v = Math.sqrt(2*a*d); return { text: `A ${m} kg block slides down a ${angle}° frictionless slope for ${d} m. Find speed.`, answer: v.toFixed(2), modelAnswer: `Speed ≈ ${v.toFixed(2)} m/s.`, image: createSlopeSVG(20, 23, 5) }; }
      },
      {
        topic: 2, difficulty: "hard", type: "numeric_multi",
        question: function() { const mass = 20, angle = 23, distance = 5, g = 9.8, a = g*Math.sin(angle*Math.PI/180), v = Math.sqrt(2*a*distance), ke = 0.5*mass*v*v; return { text: `A ${mass} kg block slides down a ${angle}° slope for ${distance} m. Calculate: (a) acceleration (m/s²), (b) final speed (m/s), (c) kinetic energy (J).`, answer: [a.toFixed(2), v.toFixed(2), ke.toFixed(2)], modelAnswer: [`a ≈ ${a.toFixed(2)} m/s²`, `v ≈ ${v.toFixed(2)} m/s`, `KE ≈ ${ke.toFixed(2)} J`], image: createSlopeSVG(mass, angle, distance) }; }
      },
      {
        topic: 2, difficulty: "hard", type: "equation",
        question: function() { const u = Math.floor(Math.random()*10+10), angle = Math.floor(Math.random()*30+30), g = 9.8, R = (u*u*Math.sin(2*angle*Math.PI/180))/g; return { text: `A projectile is launched at ${angle}° with speed ${u} m/s. Find horizontal range.`, answer: R.toFixed(2), modelAnswer: `Range ≈ ${R.toFixed(2)} m.` }; }
      },
      {
        topic: 2, difficulty: "easy", type: "equation",
        question: function() { const h = Math.floor(Math.random()*20+10), g = 9.8, t = Math.sqrt((2*h)/g); return { text: `An object is launched horizontally from ${h} m. Find time to hit ground.`, answer: t.toFixed(2), modelAnswer: `Time ≈ ${t.toFixed(2)} s.` }; }
      },
      {
        topic: 2, difficulty: "easy", type: "equation",
        question: function() { const t = Math.floor(Math.random()*4+2), g = 9.8, s = 0.5*g*t*t; return { text: `An object free-falls for ${t} s. Find distance fallen.`, answer: s.toFixed(1), modelAnswer: `Distance ≈ ${s.toFixed(1)} m.` }; }
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "Define displacement.",
        modelAnswer: "Displacement is the change in position in a specific direction.",
        keywords: [["displacement", "distance"], ["direction", "oriented"]]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "Define speed.",
        modelAnswer: "Speed is the distance traveled per unit time.",
        keywords: [["distance"], ["time", "per second"]]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "Define velocity.",
        modelAnswer: "Velocity is displacement per unit time, with direction.",
        keywords: [["displacement"], ["time"], ["direction"]]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "Define acceleration.",
        modelAnswer: "Acceleration is the rate of change of velocity per unit time.",
        keywords: [["change", "rate"], ["velocity"], ["time"]]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "State what the gradient of a displacement–time graph represents.",
        modelAnswer: "It represents velocity.",
        keywords: [["gradient"], ["velocity"]]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "State what the gradient of a velocity–time graph represents.",
        modelAnswer: "It represents acceleration.",
        keywords: [["gradient"], ["acceleration"]]
      },
      {
        topic: 2, difficulty: "easy", type: "definition",
        question: "State what the area under a velocity–time graph represents.",
        modelAnswer: "It represents displacement.",
        keywords: [["area"], ["displacement"]]
      },
      
      // --- Topic 3: Dynamics ---
      {
        topic: 3, difficulty: "easy", type: "equation",
        question: function() { const L = Math.floor(Math.random()*5+1), W = Math.floor(Math.random()*50+20), angle = Math.floor(Math.random()*30+30), radians = angle*Math.PI/180, T = (W*L/2)/(L*Math.sin(radians)); return { text: `A beam of length ${L} m and weight ${W} N is supported at ${angle}°. Find the tension.`, answer: T.toFixed(1), modelAnswer: `Tension ≈ ${T.toFixed(1)} N.` }; }
      },
      {
        topic: 3, difficulty: "easy", type: "equation",
        question: function() { const m1 = 2, m2 = 3, u1 = 3, u2 = 0, vf = (m1*u1+m2*u2)/(m1+m2); return { text: `A ${m1} kg object at 3 m/s collides with a ${m2} kg object at rest. Find final speed.`, answer: vf.toFixed(2), modelAnswer: `Final speed ≈ ${vf.toFixed(2)} m/s.` }; }
      },
      {
        topic: 3, difficulty: "easy", type: "equation",
        question: function() { const m = Math.floor(Math.random()*20+5), a = Math.floor(Math.random()*5+1), F = m*a; return { text: `A ${m} kg object accelerates at ${a} m/s². Find net force.`, answer: F.toFixed(1), modelAnswer: `Force ≈ ${F.toFixed(1)} N.` }; }
      },
      {
        topic: 3, difficulty: "easy", type: "equation",
        question: function() { const F_applied = Math.floor(Math.random()*50+50), friction = Math.floor(Math.random()*20+10), netF = F_applied - friction; return { text: `A force of ${F_applied} N and friction of ${friction} N oppose each other. Find net force.`, answer: netF.toFixed(1), modelAnswer: `Net force ≈ ${netF.toFixed(1)} N.` }; }
      },
      {
        topic: 3, difficulty: "hard", type: "numeric_multi",
        question: function() { const m1 = 2, m2 = 3, u1 = Math.floor(Math.random()*10+5), u2 = Math.floor(Math.random()*10), v1 = ((m1-m2)/(m1+m2))*u1 + ((2*m2)/(m1+m2))*u2; return { text: `A ${m1} kg object at ${u1} m/s collides elastically with a ${m2} kg object at ${u2} m/s. Find final speed of the ${m1} kg object.`, answer: v1.toFixed(2), modelAnswer: `Final speed ≈ ${v1.toFixed(2)} m/s.` }; }
      },
      {
        topic: 3, difficulty: "hard", type: "numeric_multi",
        question: function() {
          const m1 = 2, m2 = 3, v1i = 5, v1f = 3, theta1 = 30;
          const v1fx = v1f * Math.cos(theta1*Math.PI/180);
          const v1fy = v1f * Math.sin(theta1*Math.PI/180);
          const p_initial_x = m1*v1i;
          const p1x = m1*v1fx;
          const v2fx = (p_initial_x - p1x)/m2;
          const v2fy = - (m1*v1fy)/m2;
          const v2f = Math.sqrt(v2fx*v2fx + v2fy*v2fy);
          const theta2 = Math.atan2(v2fy, v2fx)*(180/Math.PI);
          return { text: `A 2 kg ball at 5 m/s collides with a 3 kg ball at rest. After collision, the 2 kg ball moves at 3 m/s at 30° above horizontal. Find: (a) the speed of the 3 kg ball, (b) its angle (negative if below horizontal).`, answer: [v2f.toFixed(2), theta2.toFixed(2)], modelAnswer: [`Speed ≈ ${v2f.toFixed(2)} m/s`, `Angle ≈ ${theta2.toFixed(2)}°`] };
        }
      },
      {
        topic: 3, difficulty: "easy", type: "definition",
        question: "State Newton’s First Law of Motion.",
        modelAnswer: "A body remains at rest or in uniform motion unless acted upon by a net force.",
        keywords: [["remains at rest", "constant motion"], ["no net force", "unopposed"]]
      },
      {
        topic: 3, difficulty: "easy", type: "definition",
        question: "State Newton’s Second Law of Motion.",
        modelAnswer: "The acceleration of an object is directly proportional to the net force acting on it and inversely proportional to its mass.",
        keywords: [["acceleration"], ["net force"], ["mass"]]
      },
      {
        topic: 3, difficulty: "easy", type: "definition",
        question: "State Newton’s Third Law of Motion.",
        modelAnswer: "For every action, there is an equal and opposite reaction.",
        keywords: [["equal", "opposite"], ["action", "reaction"]]
      },
      {
        topic: 3, difficulty: "easy", type: "definition",
        question: "Define inertia.",
        modelAnswer: "Inertia is the tendency of an object to resist changes in its motion.",
        keywords: [["tendency", "inertia"], ["resist", "change", "motion"]]
      },
      
      // --- Topic 4: Forces, density and pressure ---
      {
        topic: 4, difficulty: "easy", type: "equation",
        question: function() { const h = Math.floor(Math.random()*10+5), rho = 1000, g = 9.8, pressure = rho*g*h; return { text: `At ${h} m depth in water, find pressure (Pa).`, answer: pressure.toFixed(0), modelAnswer: `Pressure ≈ ${pressure.toFixed(0)} Pa.` }; }
      },
      {
        topic: 4, difficulty: "easy", type: "equation",
        question: function() { const V = Math.floor(Math.random()*100+100), rho = 1000, g = 9.8, V_m3 = V/1e6, F_b = rho*g*V_m3; return { text: `An object displaces ${V} cm³ of water. Find buoyant force (N).`, answer: F_b.toFixed(2), modelAnswer: `Buoyant force ≈ ${F_b.toFixed(2)} N.` }; }
      },
      {
        topic: 4, difficulty: "easy", type: "equation",
        question: function() { const A = Math.floor(Math.random()*50+50), h = Math.floor(Math.random()*4+2), rho = 1000, g = 9.8, A_m2 = A/10000, F = rho*g*h*A_m2; return { text: `For a container with base area ${A} cm² and water height ${h} m, find the force on the base (N).`, answer: F.toFixed(1), modelAnswer: `Force ≈ ${F.toFixed(1)} N.` }; }
      },
      {
        topic: 4, difficulty: "easy", type: "definition",
        question: "Define pressure.",
        modelAnswer: "Pressure is defined as force per unit area.",
        keywords: [["force"], ["area", "surface"]]
      },
      {
        topic: 4, difficulty: "easy", type: "definition",
        question: "Define density.",
        modelAnswer: "Density is the mass per unit volume.",
        keywords: [["mass"], ["volume"]]
      },
      {
        topic: 4, difficulty: "hard", type: "numeric_multi",
        question: function() { const area_cm2 = 500, height = 2.5, rho = 1000, g = 9.8, area_m2 = area_cm2/10000, pressure = rho*g*height, extra = 0.1*pressure, extraForce = extra*area_m2; return { text: `A container with ${area_cm2} cm² base and ${height} m water. Calculate: (a) pressure (Pa), (b) extra force for a 10% increase.`, answer: [pressure.toFixed(0)+" Pa", extraForce.toFixed(2)+" N"], modelAnswer: [`Pressure ≈ ${pressure.toFixed(0)} Pa`, `Extra force ≈ ${extraForce.toFixed(2)} N`] }; }
      },
      
      // --- Topic 5: Work, energy and power ---
      {
        topic: 5, difficulty: "easy", type: "equation",
        question: function() { const m = Math.floor(Math.random()*10+1), v = Math.floor(Math.random()*10+1), KE = 0.5*m*v*v; return { text: `Calculate kinetic energy of a ${m} kg object at ${v} m/s.`, answer: KE.toFixed(1), modelAnswer: `KE ≈ ${KE.toFixed(1)} J.` }; }
      },
      {
        topic: 5, difficulty: "easy", type: "equation",
        question: function() { const m = Math.floor(Math.random()*10+1), h = Math.floor(Math.random()*10+1), g = 9.8, GPE = m*g*h; return { text: `A ${m} kg object is raised ${h} m. Find GPE (J).`, answer: GPE.toFixed(1), modelAnswer: `GPE ≈ ${GPE.toFixed(1)} J.` }; }
      },
      {
        topic: 5, difficulty: "easy", type: "equation",
        question: function() { const W = Math.floor(Math.random()*200+100), t = Math.floor(Math.random()*10+1), P = W/t; return { text: `If ${W} J is done in ${t} s, find power (W).`, answer: P.toFixed(1), modelAnswer: `Power ≈ ${P.toFixed(1)} W.` }; }
      },
      {
        topic: 5, difficulty: "easy", type: "equation",
        question: function() { const F = Math.floor(Math.random()*50+50), d = Math.floor(Math.random()*10+5), work = F*d; return { text: `A force of ${F} N moves an object ${d} m. Find work (J).`, answer: work.toFixed(1), modelAnswer: `Work ≈ ${work.toFixed(1)} J.` }; }
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "State what is meant by the work done by a force.",
        modelAnswer: "Work is done when a force causes an object to move in the direction of the force.",
        keywords: [["force"], ["move", "displacement", "movement"], ["direction"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Define kinetic energy.",
        modelAnswer: "Kinetic energy is the energy of motion, given by ½×mass×velocity².",
        keywords: [["kinetic", "motion"], ["half", "½"], ["mass"], ["velocity", "speed", "squared"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Define power.",
        modelAnswer: "Power is the rate at which work is done.",
        keywords: [["rate"], ["work"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of power to determine its SI base units.",
        modelAnswer: "Power is measured in watts (W) with SI base units of kg·m²/s³.",
        keywords: [["kg"], ["m²", "m2", "m^2"], ["s^-3", "s-3", "per s3", "per s^3"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of work to determine its SI base units.",
        modelAnswer: "Work (J) has SI base units of kg·m²/s².",
        keywords: [["kg"], ["m²", "m2", "m^2"], ["s^-2", "s-2", "per s2", "per s^2"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of force (F = m·a) to determine its SI base units.",
        modelAnswer: "Force (N) has SI base units of kg·m/s².",
        keywords: [["kg"], ["m/s²", "m/s^2", "m s^-2"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of pressure (P = F/A) to determine its SI base units.",
        modelAnswer: "Pressure (Pa) has SI base units of kg/(m·s²).",
        keywords: [["kg"], ["m"], ["s^-2", "s-2", "per s2", "per s^2"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of momentum (p = m·v) to determine its SI base units.",
        modelAnswer: "Momentum has SI base units of kg·m/s.",
        keywords: [["kg"], ["m/s", "m s^-1", "m/s^1"]]
      },
      {
        topic: 5, difficulty: "easy", type: "definition",
        question: "Use the definition of strain to determine its SI base units.",
        modelAnswer: "Strain is dimensionless and has no units.",
        keywords: [["dimensionless"], ["no units"]]
      },
      {
        topic: 5, difficulty: "hard", type: "numeric_multi",
        question: function() { const Vin = 9.0, R_fixed = 1800, V_fixed = 5.4; const I = V_fixed/R_fixed; const V_LDR = Vin - V_fixed; const R_LDR = V_LDR/I; return { text: `A ${Vin} V battery, an LDR, and a ${R_fixed} Ω resistor are in series. If a voltmeter reads ${V_fixed} V, calculate: (a) current (A) and (b) LDR resistance (Ω).`, answer: [I.toFixed(3)+" A", R_LDR.toFixed(0)+" Ω"], modelAnswer: [`I ≈ ${I.toFixed(3)} A`, `R_LDR ≈ ${R_LDR.toFixed(0)} Ω`] }; }
      },
      
      // --- Topic 6: Deformation of solids ---
      {
        topic: 6, difficulty: "easy", type: "equation",
        question: function() { const stress = Math.floor(Math.random()*10+5), strain = Math.random()*0.01+0.001, E = stress/strain; return { text: `A material has stress ${stress} MPa and strain ${strain.toFixed(4)}. Find Young's modulus (GPa).`, answer: (E/1000).toFixed(2), modelAnswer: `E ≈ ${(E/1000).toFixed(2)} GPa.` }; }
      },
      {
        topic: 6, difficulty: "easy", type: "equation",
        question: function() { const k = Math.floor(Math.random()*200+100), F = Math.floor(Math.random()*50+10), ext = F/k; return { text: `A spring (constant ${k} N/m) is pulled with ${F} N. Find its extension (m).`, answer: ext.toFixed(3), modelAnswer: `Extension ≈ ${ext.toFixed(3)} m.` }; }
      },
      {
        topic: 6, difficulty: "easy", type: "equation",
        question: function() { const L0 = Math.floor(Math.random()*50+50), ext = (Math.floor(Math.random()*5+1))/100, strain = ext/(L0/100); return { text: `A rod of ${L0} cm is extended by ${ext.toFixed(2)} m. Find the strain.`, answer: strain.toFixed(3), modelAnswer: `Strain ≈ ${strain.toFixed(3)}.` }; }
      },
      {
        topic: 6, difficulty: "easy", type: "definition",
        question: "State Hooke's Law.",
        modelAnswer: "Hooke's Law states that the extension of a spring is proportional to the applied force, within the elastic limit.",
        keywords: [["extension", "stretch"], ["proportional"], ["force"]]
      },
      {
        topic: 6, difficulty: "easy", type: "definition",
        question: "Define stress.",
        modelAnswer: "Stress is the force per unit cross-sectional area.",
        keywords: [["force"], ["cross-sectional area", "area"]]
      },
      {
        topic: 6, difficulty: "easy", type: "definition",
        question: "Define strain.",
        modelAnswer: "Strain is the ratio of the extension to the original length.",
        keywords: [["ratio"], ["extension"], ["original length"]]
      },
      {
        topic: 6, difficulty: "hard", type: "numeric_multi",
        question: function() { const length = 2, area = 1e-4, force = 10000, E = 200e9; const stress = force/area, strain = stress/E, elongation = length*strain; return { text: `A rod of ${length} m and area ${area} m² is under ${force} N. If E = ${E/1e9} GPa, calculate: (a) stress (Pa), (b) strain, (c) elongation (m).`, answer: [stress.toExponential(2)+" Pa", strain.toExponential(2), elongation.toExponential(2)+" m"], modelAnswer: [`Stress ≈ ${stress.toExponential(2)} Pa`, `Strain ≈ ${strain.toExponential(2)}`, `Elongation ≈ ${elongation.toExponential(2)} m`] }; }
      },
      
      // --- Topic 7: Waves ---
      {
        topic: 7, difficulty: "easy", type: "equation",
        question: function() { const n = Math.floor(Math.random()*3+1), L = Math.floor(Math.random()*3+1), v = Math.floor(Math.random()*200+100), f = (n*v)/(2*L); return { text: `A pipe closed at both ends (length ${L} m, wave speed ${v} m/s) vibrates in its ${ordinalSuffix(n)} harmonic. Find its frequency (Hz).`, answer: f.toFixed(1), modelAnswer: `Frequency ≈ ${f.toFixed(1)} Hz.` }; }
      },
      {
        topic: 7, difficulty: "easy", type: "equation",
        question: function() { const d = (Math.floor(Math.random()*4+1))/1000, D = Math.floor(Math.random()*100+100), x = (Math.floor(Math.random()*20+10))/1000, lambda = (d*x)/(D/100); return { text: `In a double-slit experiment (slit separation ${(d*1000).toFixed(1)} mm, screen ${D} cm, fringe spacing ${(x*1000).toFixed(1)} mm), find the wavelength (nm).`, answer: (lambda*1e9).toFixed(1), modelAnswer: `Wavelength ≈ ${(lambda*1e9).toFixed(1)} nm.` }; }
      },
      {
        topic: 7, difficulty: "easy", type: "equation",
        question: function() { const L = Math.floor(Math.random()*3+1), v = Math.floor(Math.random()*100+300), f = v/(2*L), T = 1/f; return { text: `A pipe open at both ends (length ${L} m, sound speed ${v} m/s) vibrates. (a) Find the fundamental frequency, (b) the time period.`, answer: [f.toFixed(1), T.toFixed(3)], modelAnswer: [`Fundamental frequency ≈ ${f.toFixed(1)} Hz`, `Time period ≈ ${T.toFixed(3)} s`], type:"numeric_multi", multi:true }; }
      },
      {
        topic: 7, difficulty: "easy", type: "definition",
        question: "Define wavelength.",
        modelAnswer: "Wavelength is the distance between successive points in phase on a wave.",
        keywords: [["distance"], ["successive", "between successive"], ["in phase", "phase"]]
      },
      {
        topic: 7, difficulty: "easy", type: "definition",
        question: "Define frequency.",
        modelAnswer: "Frequency is the number of oscillations per second.",
        keywords: [["oscillations", "cycles", "vibrations"], ["per second", "Hz"]]
      },
      {
        topic: 7, difficulty: "easy", type: "definition",
        question: "Define wavefront.",
        modelAnswer: "A wavefront is a line connecting points of equal phase on a wave.",
        keywords: [["line"], ["equal phase", "same phase", "connecting"]]
      },
      {
        topic: 7, difficulty: "hard", type: "numeric_multi",
        question: function() { const L = 2, v = 305, f = v/(4*L), T = 1/f; return { text: `A pipe closed at one end (length ${L} m, sound speed ${v} m/s) vibrates. Calculate: (a) fundamental frequency, (b) time period, (c) verify f×T ≈ 1.`, answer: [f.toFixed(1), T.toFixed(3), (f*T).toFixed(2)], modelAnswer: [`Fundamental frequency ≈ ${f.toFixed(1)} Hz`, `Time period ≈ ${T.toFixed(3)} s`, `f×T ≈ ${(f*T).toFixed(2)}`], multi:true }; }
      },
      
      // --- Topic 8: Superposition ---
      {
        topic: 8, difficulty: "easy", type: "equation",
        question: function() { const A1 = Math.floor(Math.random()*5+5), A2 = Math.floor(Math.random()*5+5), result = A1 + A2; return { text: `Two waves with amplitudes ${A1} and ${A2} add constructively. Find resultant amplitude.`, answer: result.toFixed(1), modelAnswer: `Resultant amplitude = ${A1} + ${A2} = ${result}.` }; }
      },
      {
        topic: 8, difficulty: "easy", type: "equation",
        question: function() { const A1 = Math.floor(Math.random()*5+5), A2 = Math.floor(Math.random()*5+1), result = Math.abs(A1 - A2); return { text: `Two waves with amplitudes ${A1} and ${A2} combine destructively. Find resultant amplitude.`, answer: result.toFixed(1), modelAnswer: `Resultant amplitude = |${A1} - ${A2}| = ${result}.` }; }
      },
      {
        topic: 8, difficulty: "easy", type: "definition",
        question: "State the principle of superposition.",
        modelAnswer: "When waves overlap, the total displacement is the sum of the individual displacements.",
        keywords: [["sum", "total"], ["displacement", "overlap"]]
      },
      {
        topic: 8, difficulty: "easy", type: "definition",
        question: "Define constructive interference.",
        modelAnswer: "Constructive interference occurs when waves in phase add together to increase amplitude.",
        keywords: [["in phase"], ["add", "reinforce", "increase"]]
      },
      {
        topic: 8, difficulty: "easy", type: "definition",
        question: "Define destructive interference.",
        modelAnswer: "Destructive interference occurs when waves out of phase cancel each other out.",
        keywords: [["out of phase"], ["cancel", "reduce"]]
      },
      
      // --- Topic 9: Electricity ---
      {
        topic: 9, difficulty: "easy", type: "equation",
        question: function() { const I = Math.floor(Math.random()*5+1), R = Math.floor(Math.random()*20+10), V = I*R; return { text: `A current of ${I} A flows through a ${R} Ω resistor. Find the voltage.`, answer: V.toFixed(1), modelAnswer: `Voltage ≈ ${V.toFixed(1)} V.` }; }
      },
      {
        topic: 9, difficulty: "easy", type: "equation",
        question: function() { const V = Math.floor(Math.random()*20+10), I = Math.floor(Math.random()*5+1), P = V*I; return { text: `Find the power for a circuit with ${V} V and ${I} A.`, answer: P.toFixed(1), modelAnswer: `Power ≈ ${P.toFixed(1)} W.` }; }
      },
      {
        topic: 9, difficulty: "easy", type: "equation",
        question: function() { const R1 = Math.floor(Math.random()*20+10), R2 = Math.floor(Math.random()*20+10), R3 = Math.floor(Math.random()*20+10), Rp = 1/(1/R1+1/R2), R_total = Rp + R3; return { text: `Calculate total resistance of ${R1} Ω and ${R2} Ω in parallel, then in series with ${R3} Ω.`, answer: R_total.toFixed(1), modelAnswer: `Total resistance ≈ ${R_total.toFixed(1)} Ω.` }; }
      },
      {
        topic: 9, difficulty: "easy", type: "definition",
        question: "Define electric current.",
        modelAnswer: "Electric current is the rate of flow of electric charge.",
        keywords: [["rate", "flow"], ["charge"]]
      },
      {
        topic: 9, difficulty: "easy", type: "definition",
        question: "Define electromotive force (e.m.f.).",
        modelAnswer: "Electromotive force is the work done per unit charge by a source.",
        keywords: [["work done"], ["per unit charge"]]
      },
      {
        topic: 9, difficulty: "easy", type: "definition",
        question: "Define electric potential difference.",
        modelAnswer: "Electric potential difference is the work per unit charge required to move a charge between two points.",
        keywords: [["work", "work done"], ["per unit charge"], ["between two points"]]
      },
      {
        topic: 9, difficulty: "hard", type: "numeric_multi",
        question: function() { const R = 10, Vin = 12, I1 = Vin/R, P1 = I1*I1*R, R_series = 10, newTotal = R+R_series, I2 = Vin/newTotal; return { text: `A ${R} Ω resistor with a ${Vin} V battery. Calculate: (a) current, (b) power, (c) new current if a ${R_series} Ω resistor is added.`, answer: [I1.toFixed(2)+" A", P1.toFixed(1)+" W", I2.toFixed(2)+" A"], modelAnswer: [`I ≈ ${I1.toFixed(2)} A`, `P ≈ ${P1.toFixed(1)} W`, `New I ≈ ${I2.toFixed(2)} A`] }; }
      },
      
      // --- Topic 10: D.C. circuits ---
      {
        topic: 10, difficulty: "easy", type: "equation",
        question: function() { const R1 = Math.floor(Math.random()*50+50), R2 = Math.floor(Math.random()*50+50), Vin = Math.floor(Math.random()*20+10), Vout = Vin*(R2/(R1+R2)); return { text: `In a voltage divider with ${R1} Ω and ${R2} Ω and ${Vin} V input, find voltage across the ${R2} Ω resistor.`, answer: Vout.toFixed(1), modelAnswer: `Voltage ≈ ${Vout.toFixed(1)} V.` }; }
      },
      {
        topic: 10, difficulty: "easy", type: "equation",
        question: function() { const Vin = Math.floor(Math.random()*20+10), R_total = Math.floor(Math.random()*100+100), I = Vin/R_total; return { text: `Find current in a series circuit with ${R_total} Ω and ${Vin} V.`, answer: I.toFixed(2), modelAnswer: `Current ≈ ${I.toFixed(2)} A.` }; }
      },
      {
        topic: 10, difficulty: "easy", type: "equation",
        question: function() { const I = Math.floor(Math.random()*5+1), R = Math.floor(Math.random()*100+50), P = I*I*R; return { text: `Calculate power in a ${R} Ω resistor with ${I} A.`, answer: P.toFixed(1), modelAnswer: `Power ≈ ${P.toFixed(1)} W.` }; }
      },
      {
        topic: 10, difficulty: "easy", type: "equation",
        question: function() { const R1 = Math.floor(Math.random()*50+50), R2 = Math.floor(Math.random()*50+50), R3 = Math.floor(Math.random()*50+50), R_total = R1+R2+R3; return { text: `Find total resistance for series resistors: ${R1} Ω, ${R2} Ω, ${R3} Ω.`, answer: R_total.toFixed(1), modelAnswer: `Total resistance = ${R_total} Ω.` }; }
      },
      {
        topic: 10, difficulty: "easy", type: "definition",
        question: "Define resistance.",
        modelAnswer: "Resistance is the ratio of voltage to current.",
        keywords: [["voltage"], ["current"], ["ratio"]]
      },
      {
        topic: 10, difficulty: "easy", type: "definition",
        question: "Define internal resistance.",
        modelAnswer: "Internal resistance is the resistance inside a power source causing a voltage drop.",
        keywords: [["internal"], ["power source"], ["resistance"]]
      },
      {
        topic: 10, difficulty: "hard", type: "numeric_multi",
        question: function() { const R1 = 100, R2 = 200, R3 = 300, Vin = 12, R_total = R1+R2+R3, I = Vin/R_total, V_R2 = I*R2, power_R2 = V_R2*V_R2/R2; return { text: `For series resistors ${R1} Ω, ${R2} Ω, ${R3} Ω with ${Vin} V, calculate: (a) voltage across ${R2} Ω and (b) power in it.`, answer: [V_R2.toFixed(2)+" V", power_R2.toFixed(2)+" W"], modelAnswer: [`V ≈ ${V_R2.toFixed(2)} V`, `Power ≈ ${power_R2.toFixed(2)} W`] }; }
      },
      
      // --- Topic 11: Particle and nuclear physics ---
      {
        topic: 11, difficulty: "easy", type: "equation",
        question: function() { const initialN = Math.floor(Math.random()*50+50); return { text: `In β– decay, if nucleon number is ${initialN}, what is it after decay?`, answer: initialN.toString(), modelAnswer: `It remains ${initialN}.` }; }
      },
      {
        topic: 11, difficulty: "easy", type: "equation",
        question: function() { const initialZ = Math.floor(Math.random()*20+10), finalZ = initialZ - 1; return { text: `A nucleus with proton number ${initialZ} undergoes β+ decay. New proton number?`, answer: finalZ.toString(), modelAnswer: `Proton number becomes ${finalZ}.` }; }
      },
      {
        topic: 11, difficulty: "easy", type: "equation",
        question: function() { const initialMass = Math.floor(Math.random()*200+100), finalMass = initialMass - 4; return { text: `A nucleus with mass number ${initialMass} undergoes alpha decay. New mass number?`, answer: finalMass.toString(), modelAnswer: `Mass number becomes ${finalMass}.` }; }
      },
      {
        topic: 11, difficulty: "easy", type: "equation",
        question: function() { const initialMass = Math.floor(Math.random()*200+100), change = 4; return { text: `A nucleus with mass number ${initialMass} undergoes alpha decay. By how much does it change?`, answer: change.toString(), modelAnswer: `It decreases by 4.` }; }
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define nucleon number.",
        modelAnswer: "Nucleon number is the total number of protons and neutrons in a nucleus.",
        keywords: [["protons"], ["neutrons"], ["total"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define proton number.",
        modelAnswer: "Proton number is the number of protons in a nucleus.",
        keywords: [["proton", "number"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define isotope.",
        modelAnswer: "Isotopes are atoms of the same element with the same number of protons but different numbers of neutrons.",
        keywords: [["same element"], ["protons"], ["different neutrons"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define a hadron.",
        modelAnswer: "A hadron is a particle made of quarks that experiences the strong force.",
        keywords: [["quarks", "3 quarks", "three quarks"], ["strong force"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define a baryon.",
        modelAnswer: "A baryon is a hadron consisting of three quarks.",
        keywords: [["three quarks", "3 quarks"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define a meson.",
        modelAnswer: "A meson is a hadron composed of a quark and an antiquark.",
        keywords: [["quark"], ["antiquark"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define a lepton.",
        modelAnswer: "A lepton is a fundamental particle that does not experience the strong force.",
        keywords: [["fundamental"], ["does not feel", "not affected", "not effected", "no strong force"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define a quark.",
        modelAnswer: "A quark is a fundamental particle that comes in types such as up, down, charm, strange, top, and bottom.",
        keywords: [["up"], ["down"], ["charm"], ["strange"], ["top"], ["bottom"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "State the charges of up and down quarks.",
        modelAnswer: "The up quark has a charge of +2/3 e and the down quark has a charge of -1/3 e.",
        keywords: [["+2/3", "2/3"], ["-1/3", "1/3"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "State the quark composition of a proton.",
        modelAnswer: "A proton is composed of two up quarks and one down quark (uud).",
        keywords: [["2 u", "2 up", "two up", "1 d", "1 down", "uud", "2u1d", "2 up 1 down", "duu", "udu"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "State the quark composition of a neutron.",
        modelAnswer: "A neutron is composed of one up quark and two down quarks (udd).",
        keywords: [["1 u", "one up", "2 d", "two down", "udd", "1up2down", "dud", "ddu"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define an antiparticle.",
        modelAnswer: "An antiparticle has the same mass as its corresponding particle but opposite charge.",
        keywords: [["same mass"], ["opposite charge"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "What is emitted during β– decay?",
        modelAnswer: "During β– decay, an electron and an electron antineutrino are emitted.",
        keywords: [["electron"], ["antineutrino"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "What is emitted during β+ decay?",
        modelAnswer: "During β+ decay, a positron and an electron neutrino are emitted.",
        keywords: [["positron"], ["electron neutrino"]]
      },
      {
        topic: 11, difficulty: "easy", type: "definition",
        question: "Define the unified atomic mass unit (u).",
        modelAnswer: "One unified atomic mass unit is defined as 1/12 the mass of a carbon-12 atom.",
        keywords: [["1/12"], ["carbon-12"]]
      },
      {
        topic: 11, difficulty: "hard", type: "numeric_multi",
        question: function() { return { text: `A nucleus with mass number 210 and atomic number 84 undergoes β– decay followed by alpha decay. Calculate the final mass and atomic numbers.`, answer: ["206", "83"], modelAnswer: [`Mass number becomes 206.`, `Atomic number becomes 83.`] }; }
      }
    ];
    
    // Utility: Get selected difficulty
    function getSelectedDifficulty() {
      const radios = document.getElementsByName("difficulty");
      for (let radio of radios) {
        if (radio.checked) return radio.value;
      }
      return "easy";
    }
    
    // Mixed mode: 2 easy for every 1 hard.
    function getMixedQuestion() {
      if (mixedCount % 3 < 2) {
        return getRandom(questionBank.filter(q => (q.difficulty==="easy" || !q.difficulty) && q.type !== "definition"));
      } else {
        return getRandom(questionBank.filter(q => q.difficulty==="hard" && q.type !== "definition"));
      }
    }
    
    // UI Elements
    const questionBox = document.getElementById("question-box");
    const scoreDisplay = document.getElementById("score");
    const diagramContainer = document.getElementById("diagramContainer") || { innerHTML: "" };
    const answerInputs = document.createElement("div");
    answerInputs.id = "answerInputs";
    questionBox.parentNode.insertBefore(answerInputs, questionBox.nextSibling);
    const feedback = document.createElement("div");
    feedback.id = "feedback";
    questionBox.parentNode.insertBefore(feedback, answerInputs.nextSibling);
    
    // Load a question
    function loadQuestion(q) {
      answeredCurrent = false;
      currentQuestion = q;
      feedback.innerText = "";
      document.getElementById("score").innerText = score;
      // Clear question box and answer inputs
      questionBox.innerHTML = "";
      answerInputs.innerHTML = "";
      diagramContainer.innerHTML = "";
      
      // Display question text
      questionBox.innerHTML = `<strong>Question:</strong> ${q.question}`;
      
      // If question has image property, display it
      if (q.image) diagramContainer.innerHTML = q.image;
      
      // Create input(s)
      if (q.type==="definition" || q.type==="numeric" || q.type==="numeric_dynamic") {
        const inp = document.createElement("input");
        inp.type = "text";
        inp.id = "answerInput";
        inp.placeholder = "Enter answer...";
        answerInputs.appendChild(inp);
        currentAnswers = q.answer ? [q.answer] : q.keywords;
      } else if (q.type==="numeric_multi") {
        const inp1 = document.createElement("input");
        inp1.type = "text";
        inp1.id = "answerInput1";
        inp1.placeholder = "Part (a)";
        inp1.style.width = "100px";
        const inp2 = document.createElement("input");
        inp2.type = "text";
        inp2.id = "answerInput2";
        inp2.placeholder = "Part (b)";
        inp2.style.width = "100px";
        inp2.style.marginLeft = "10px";
        answerInputs.appendChild(inp1);
        answerInputs.appendChild(inp2);
        currentAnswers = q.answer;
      }
    }
    
    // Next question logic
    function nextQuestion() {
      const selectedDiff = getSelectedDifficulty();
      let pool = [];
      if (selectedDiff==="easy") {
        pool = questionBank.filter(q => (q.difficulty==="easy" || !q.difficulty));
      } else if (selectedDiff==="hard") {
        pool = questionBank.filter(q => q.difficulty==="hard");
      } else if (selectedDiff==="mixed") {
        const mixedQ = getMixedQuestion();
        if (mixedQ) { loadQuestion(mixedQ); mixedCount++; return; }
      }
      if (pool.length===0) {
        questionBox.innerHTML = "No matching questions.";
        return;
      }
      loadQuestion(getRandom(pool));
    }
    
    // Check answer (score only once)
    function checkAnswer() {
      if (answeredCurrent) return;
      let userAns = "";
      if (currentQuestion.type==="numeric_multi") {
        const a = document.getElementById("answerInput1").value.trim();
        const b = document.getElementById("answerInput2").value.trim();
        userAns = [a, b];
      } else {
        userAns = document.getElementById("answerInput").value.trim();
      }
      
      let correct = false;
      if (currentQuestion.type==="definition") {
        const ansLower = userAns.toLowerCase();
        correct = true;
        for (let group of currentQuestion.keywords) {
          let found = group.some(word => ansLower.includes(word));
          if (!found) { correct = false; break; }
        }
      } else if (currentQuestion.type==="numeric" || currentQuestion.type==="numeric_dynamic") {
        const userNum = parseFloat(userAns);
        const correctNum = parseFloat(currentAnswers[0]);
        if (!isNaN(userNum) && Math.abs(userNum-correctNum) < Math.max(0.01*Math.abs(correctNum),0.1))
          correct = true;
      } else if (currentQuestion.type==="numeric_multi") {
        correct = true;
        for (let i=0; i<currentAnswers.length; i++) {
          const userNum = parseFloat(userAns[i]);
          const correctNum = parseFloat(currentAnswers[i]);
          if (isNaN(userNum) || Math.abs(userNum-correctNum) > Math.max(0.01*Math.abs(correctNum),0.1)) {
            correct = false; break;
          }
        }
      }
      
      if (correct) { feedback.innerText = "✔ Correct!"; score++; document.getElementById("score").innerText = score; }
      else { feedback.innerText = "✘ Not quite correct."; }
      answeredCurrent = true;
    }
    
    function showModelAnswer() {
      if (!currentQuestion) return;
      let modelText = "Model Answer: ";
      if (currentQuestion.type==="numeric_multi") {
        modelText += currentQuestion.modelAnswer.join(" | ");
      } else {
        modelText += currentQuestion.modelAnswer;
      }
      feedback.innerText = modelText;
      answeredCurrent = true;
    }
    
    // Event listeners for difficulty buttons
    document.getElementById("difficulty-go-easy").addEventListener("click", function(){ currentMode="easy"; score=0; nextQuestion(); });
    document.getElementById("difficulty-im-getting-there").addEventListener("click", function(){ currentMode="mixed"; mixedCount=0; score=0; nextQuestion(); });
    document.getElementById("difficulty-hard").addEventListener("click", function(){ currentMode="hard"; score=0; nextQuestion(); });
    
    // Event listeners for answer buttons
    // Create buttons dynamically if not already present:
    const checkBtn = document.createElement("button");
    checkBtn.innerText = "Check Answer";
    checkBtn.addEventListener("click", checkAnswer);
    answerInputs.parentNode.insertBefore(checkBtn, answerInputs.nextSibling);
    
    const showAnswerBtn = document.createElement("button");
    showAnswerBtn.innerText = "Show Model Answer";
    showAnswerBtn.addEventListener("click", showModelAnswer);
    checkBtn.parentNode.insertBefore(showAnswerBtn, checkBtn.nextSibling);
    
    const nextBtn = document.createElement("button");
    nextBtn.innerText = "Next Question";
    nextBtn.addEventListener("click", nextQuestion);
    nextBtn.disabled = false;
    showAnswerBtn.parentNode.insertBefore(nextBtn, showAnswerBtn.nextSibling);
    
    // On load, generate topic checkboxes.
    generateTopicCheckboxes();
  </script>
</body>
</html>
